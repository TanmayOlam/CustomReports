<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="book_value_drilldown_details" language="groovy" pageWidth="1190" pageHeight="842" orientation="Landscape" columnWidth="1150" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="99e9b555-c650-4344-a349-2294c5f4bd4c">
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<property name="net.sf.jasperreports.export.xls.fit.width" value="1"/>
	<property name="net.sf.jasperreports.export.pdf.size.page.to.content" value="true"/>
	<property name="net.sf.jasperreports.export.xls.ignore.graphics" value="false"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<property name="net.sf.jasperreports.export.xls.ignore.cell.border" value="false"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="SQL Server"/>
	<property name="ireport.jasperserver.reportUnit" value="/reports/TEST/Future_Book_Value_Detais"/>
	<property name="ireport.jasperserver.url" value="http://localhost:8080/jasperserver/services/repository"/>
	<style name="Table_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table_CH" mode="Opaque" backcolor="#8DB4E2" fontName="Arial">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.0" lineColor="#000000"/>
			<leftPen lineWidth="0.0" lineColor="#000000"/>
			<bottomPen lineWidth="0.0" lineColor="#000000"/>
			<rightPen lineWidth="0.0" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 1_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 1_CH" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 1_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 2_TH" mode="Opaque" backcolor="#FFCC00">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 2_CH" mode="Opaque" backcolor="#FFCC00">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 2_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 3_TH" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 3_CH" mode="Opaque" backcolor="#FFCC00">
		<box leftPadding="0" rightPadding="0">
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 3_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table">
		<box>
			<pen lineWidth="1.0" lineColor="#000000"/>
		</box>
	</style>
	<style name="table_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table_CH" mode="Opaque" backcolor="#FFCC00" hAlign="Center" vAlign="Middle">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table 1">
		<box>
			<pen lineWidth="1.0" lineColor="#000000"/>
			<topPen lineWidth="0.0"/>
			<leftPen lineWidth="0.0"/>
			<bottomPen lineWidth="0.0"/>
			<rightPen lineWidth="0.0"/>
		</box>
	</style>
	<style name="table 1_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table 1_CH" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table 1_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table 2">
		<box>
			<pen lineWidth="1.0" lineColor="#000000"/>
			<topPen lineWidth="0.0"/>
			<leftPen lineWidth="0.0"/>
			<bottomPen lineWidth="0.0"/>
			<rightPen lineWidth="0.0"/>
		</box>
	</style>
	<style name="table 2_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table 2_CH" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table 2_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<subDataset name="derivatives" uuid="2eb7d6b5-2c2c-4443-9681-8654c6825726">
		<property name="com.jaspersoft.studio.data.defaultdataadapter" value="Local DB"/>
		<parameter name="ctrbook" class="java.util.Collection"/>
		<parameter name="asofdate" class="java.util.Date"/>
		<parameter name="commodity" class="java.util.Collection"/>
		<parameter name="exchange" class="java.util.Collection"/>
		<parameter name="tmonth" class="java.util.Collection"/>
		<parameter name="pc" class="java.util.Collection"/>
		<parameter name="month_name" class="java.util.Collection"/>
		<queryString>
			<![CDATA[SELECT *
FROM   (SELECT
  PNL.CONTRACT_BOOK,
  CASE
    WHEN PNL.ALLOCATION_TYPE IN ('B2B', 'B2B_CROSS_COMMODITY', 'STRING') AND
      PNL.INSTRUMENT_TYPE = 'PHYSICAL' THEN 'Linked'
    ELSE 'Unlinked'
  END
  + CASE
    WHEN PNL.LONG_SHORT = 'LONG' THEN ' Purchase'
    ELSE ' Sales'
  END AS ALLOCATION_GROUP,
  CASE PNL.INSTRUMENT_TYPE
    WHEN 'FUTURES' THEN 'Futures'
    WHEN 'OPTIONS' THEN 'Options'
  END AS INSTRUMENT_TYPE,
  PNL.COMMODITY AS PRODUCT,
  PNL.PROFIT_CENTER AS UNIT,
  PNL.COUNTERPARTY AS EXCHANGE,
  PNL.POSITION_DATE AS DEAL_DATE,
  PNL.POSITION_REF AS COVER_NO,
  PNL.FUTURE_DELIVERY_MONTH AS TERMINAL_MONTH,
  PNL.FUTURE_DELIVERY_MONTHNUMBER AS TERMINAL_MONTH_NUMBER,
  (COALESCE(PNL.REALIZED_QTY, 0)
  + COALESCE(PNL.OPEN_QTY_AFTER_FIFO, 0)) * PNL._POLARITY AS QTY,
  CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN PNL._CURRENT_POS_PRICE_RPT_UOM
    ELSE FIRST_EOD.MARKET_RATE_RPT_UOM
  END AS CONTRACT_PRICE,
  PNL.POSITION_CURRENCY AS CCY,
  PNL.CURRENT_POS_TO_RPT_FXRATE AS CURRENT_FX_RATE,
  FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE AS YEAR_BEGINNING_FX_RATE,
  CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN (PNL._CURRENT_POSITION_PRICE + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))
    ELSE (FIRST_EOD.MARKET_RATE_POS_UOM + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))
  END * CAST(COALESCE(PNL.REALIZED_QTY, 0) / PNL.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(28, 14)) * PNL._POLARITY AS REALIZED_VAL,
  CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN ((PNL._CURRENT_POSITION_PRICE) + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))
    ELSE ((FIRST_EOD.MARKET_RATE_POS_UOM) + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))
  END * CAST(COALESCE(PNL.OPEN_QTY_AFTER_FIFO, 0) / PNL.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(28, 14)) * PNL._POLARITY AS OPEN_VALUE,
  PNL._SETTLEMENT_PRICE_RPT_UOM AS SETTLEMENT_PRICE,
  FIRST_EOD.MARKET_RATE_RPT_UOM AS YEAR_BEGIN_MARKET_RATE,
  (PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM) - CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN PNL._CURRENT_POSITION_PRICE
    ELSE FIRST_EOD.MARKET_RATE_POS_UOM
  END) * PNL._TOTAL_QTY_POS_UOM * PNL._POLARITY PERIOD_PNL,
  (((PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM)) * PNL.CURRENT_POS_TO_RPT_FXRATE) - CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN (PNL._CURRENT_POSITION_PRICE * PNL.CURRENT_POS_TO_RPT_FXRATE)
    ELSE (FIRST_EOD.MARKET_RATE_POS_UOM * PNL.CURRENT_POS_TO_RPT_FXRATE)
  END) * PNL._TOTAL_QTY_POS_UOM * PNL._POLARITY AS PRICE_PNL,
  (PNL.CURRENT_POS_TO_RPT_FXRATE - FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE) * PNL._TOTAL_QTY_POS_UOM * PNL._POLARITY * (PNL._CURRENT_POSITION_PRICE
  + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM)) AS FX_PNL,
  ((((PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM)) * PNL.CURRENT_POS_TO_RPT_FXRATE) - CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN (PNL._CURRENT_POSITION_PRICE * PNL.CURRENT_POS_TO_RPT_FXRATE)
    ELSE (FIRST_EOD.MARKET_RATE_POS_UOM * PNL.CURRENT_POS_TO_RPT_FXRATE)
  END) * PNL._TOTAL_QTY_POS_UOM * PNL._POLARITY) + ((PNL.CURRENT_POS_TO_RPT_FXRATE - FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE) * PNL._TOTAL_QTY_POS_UOM * PNL._POLARITY * (PNL._CURRENT_POSITION_PRICE
  + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))) AS PERIOD_PNL_RPT,
  ((PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM) - PNL._CURRENT_POSITION_PRICE) * PNL._TOTAL_QTY_POS_UOM * PNL._POLARITY * PNL.CURRENT_POS_TO_RPT_FXRATE) + ((PNL.CURRENT_POS_TO_RPT_FXRATE - FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE) * PNL._TOTAL_QTY_POS_UOM * PNL._POLARITY * (PNL._CURRENT_POSITION_PRICE
  + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))) AS PNL_FROM_DEAL_DATE,
  PNL.BASIS_MARKET_PRICE_INDEX,
  CASE
    WHEN ISNULL(PNL.PRICING_TYPE, 'PRICED') != 'PRICED' AND
      PNL.ALLOCATION_ID = PNL.PRICING_ID THEN 'BASIS'
    ELSE 'COMMODITY'
  END AS EVENT_TYPE,
  PNL.CALL_PUT,
  PNL.ALLOCATION_GROUP1,
  PNL.ALLOCATION_GROUP2
FROM (SELECT
  _PNL.*,
  CAST(_PNL.CURRENT_POSITION_PRICE AS numeric(19, 10)) _CURRENT_POSITION_PRICE,
  CAST(_PNL.CURRENT_POS_TO_RPT_FXRATE AS numeric(19, 10)) _CURRENT_POS_TO_RPT_FXRATE,
  CASE
    WHEN _PNL.LONG_SHORT = 'SHORT' THEN -1
    ELSE 1
  END AS _POLARITY,
  CAST(_PNL.CURRENT_POSITION_PRICE / COALESCE(_PNL.UOM_FACTOR_FROM_POS_TO_RPT, 1) AS numeric(19, 10)) AS _CURRENT_POS_PRICE_RPT_UOM,
  CAST((COALESCE(_PNL.CURRENT_FREIGHT_COST, 0)
  + COALESCE(_PNL.CURRENT_OTHER_COST, 0)) / COALESCE(_PNL.UOM_FACTOR_FROM_POS_TO_RPT, 1) AS numeric(19, 10)) AS _CURRENT_COST_RPT_UOM,
  CAST((COALESCE(_PNL.CURRENT_FREIGHT_COST, 0)
  + COALESCE(_PNL.CURRENT_OTHER_COST, 0)) AS numeric(19, 10)) AS _CURRENT_COST_POS_UOM,
  CAST((COALESCE(FIFO_LINKED.MATCHED_QUANTITY, 0)
  + COALESCE(FIFO_UNLINKED.BALANCE_QTY, 0)) / _PNL.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) AS _TOTAL_QTY_POS_UOM,
   CAST(CAST(ISNULL(CAST(CASE
    WHEN _PNL.INSTRUMENT_TYPE = 'FUTURES' THEN _PNL.CURRENT_FUT_MARKET_PRICE
    WHEN _PNL.INSTRUMENT_TYPE = 'OPTIONS' THEN _PNL.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(_PNL.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(_PNL.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) AS _SETTLEMENT_PRICE_POS_UOM,
  CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN _PNL.INSTRUMENT_TYPE = 'FUTURES' THEN _PNL.CURRENT_FUT_MARKET_PRICE
    WHEN _PNL.INSTRUMENT_TYPE = 'OPTIONS' THEN _PNL.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(_PNL.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(_PNL.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10))  / _PNL.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) _SETTLEMENT_PRICE_RPT_UOM,
  CAST(CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN _PNL.INSTRUMENT_TYPE = 'FUTURES' THEN _PNL.CURRENT_FUT_MARKET_PRICE
    WHEN _PNL.INSTRUMENT_TYPE = 'OPTIONS' THEN _PNL.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(_PNL.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(_PNL.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) * CAST(_PNL.CURRENT_POS_TO_RPT_FXRATE AS  numeric(19, 10)) AS  numeric(19, 10)) / _PNL.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) AS _SETTLEMENT_PRICE,
  FIFO_LINKED.MATCHED_QUANTITY AS REALIZED_QTY,
  FIFO_UNLINKED.BALANCE_QTY AS OPEN_QTY_AFTER_FIFO,
  FIFO_LINKED.ALLOCATION_GROUP AS ALLOCATION_GROUP1,
  FIFO_UNLINKED.ALLOCATION_GROUP
  + CASE
    WHEN _PNL.LONG_SHORT = 'SHORT' THEN ' Sales'
    ELSE ' Purchase'
  END AS ALLOCATION_GROUP2
FROM DAILY_PNL_ATTRIBUTION _PNL
JOIN DAILY_CONTRACT_DATA C
  ON C.POSITION_ID = _PNL.POSITION_ID
LEFT JOIN (SELECT
  POSITION_ID,
  MAX(EOD_DATE) AS EOD_DATE,
  'FIFO-Linked' AS ALLOCATION_GROUP,
  INSTRUMENT_TYPE,
  SUM(MATCHED_QUANTITY) AS MATCHED_QUANTITY
FROM (SELECT
  REPORT_DATE AS REPORT_DATE,
  SALES_ID AS POSITION_ID,
  SALES_EOD_DATE AS EOD_DATE,
  'Futures' AS INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_FUTURES
UNION ALL
SELECT
  REPORT_DATE REPORT_DATE,
  PURCHASE_ID POSITION_ID,
  PURCH_EOD_DATE EOD_DATE,
  'Futures' INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_FUTURES
UNION ALL
SELECT
  REPORT_DATE REPORT_DATE,
  SALES_ID POSITION_ID,
  SALES_EOD_DATE EOD_DATE,
  'Options' INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_OPTIONS
UNION ALL
SELECT
  REPORT_DATE REPORT_DATE,
  PURCHASE_ID POSITION_ID,
  PURCH_EOD_DATE EOD_DATE,
  'Options' INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_OPTIONS) X
WHERE X.REPORT_DATE = $P{asofdate}
GROUP BY POSITION_ID,
         INSTRUMENT_TYPE) FIFO_LINKED
  ON FIFO_LINKED.POSITION_ID = _PNL.POSITION_ID
  AND FIFO_LINKED.EOD_DATE = _PNL.EOD_DATE
LEFT JOIN (SELECT
  POSITION_ID,
  MAX(EOD_DATE) AS EOD_DATE,
  'Unlinked' AS ALLOCATION_GROUP,
  INSTRUMENT_TYPE,
  SUM(BALANCE_QTY) AS BALANCE_QTY
FROM (SELECT
  REPORT_DATE,
  POSITION_ID,
  EOD_DATE,
  'Futures' AS INSTRUMENT_TYPE,
  BALANCE_QTY
FROM DUMP_BI_FIFO_BALANCE_FUTURES
UNION ALL
SELECT
  REPORT_DATE,
  POSITION_ID,
  EOD_DATE,
  'Options' INSTRUMENT_TYPE,
  BALANCE_QTY
FROM DUMP_BI_FIFO_BALANCE_OPTIONS) X
WHERE X.REPORT_DATE = $P{asofdate}
GROUP BY POSITION_ID,
         INSTRUMENT_TYPE) FIFO_UNLINKED
  ON FIFO_UNLINKED.POSITION_ID = _PNL.POSITION_ID
  AND FIFO_UNLINKED.EOD_DATE = _PNL.EOD_DATE
WHERE (ABS(FIFO_LINKED.MATCHED_QUANTITY) > 0
OR ABS(FIFO_UNLINKED.BALANCE_QTY) > 0)) PNL
LEFT JOIN (SELECT
  X.POSITION_ID,
  X.INSTRUMENT_TYPE,
  X.CONTRACT_BOOK,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.SETTLEMENT_PRICE
    ELSE Y.SETTLEMENT_PRICE
  END MARKET_RATE,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.SETTLEMENT_PRICE_POS_UOM
    ELSE Y.SETTLEMENT_PRICE_POS_UOM
  END MARKET_RATE_POS_UOM,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.SETTLEMENT_PRICE_RPT_UOM
    ELSE Y.SETTLEMENT_PRICE_RPT_UOM
  END MARKET_RATE_RPT_UOM,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.CURRENT_POS_TO_RPT_FXRATE
    ELSE Y.CURRENT_POS_TO_RPT_FXRATE
  END CURRENT_POS_TO_RPT_FXRATE,
  Y.SETTLEMENT_PRICE EOD_MARKET_PRICE_RPT_UOM,
  Y.SETTLEMENT_PRICE_POS_UOM EOD_MARKET_PRICE_POS_UOM,
  Y.CURRENT_POS_TO_RPT_FXRATE EOD_CURRENT_POS_TO_RPT_FXRATE
FROM (SELECT
  A.POSITION_REF,
  A.POSITION_ID,
  A.INSTRUMENT_TYPE,
  A.CONTRACT_BOOK,
  A.POSITION_DATE CONTRACT_DATE,
  A.EOD_DATE,
  A.EXPIRED_DATE,
   CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10))  SETTLEMENT_PRICE_POS_UOM,
  CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10))  / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE_RPT_UOM,
  CAST(CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) * CAST(A.CURRENT_POS_TO_RPT_FXRATE AS  numeric(19, 10)) AS  numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE,
  A.CURRENT_POS_TO_RPT_FXRATE
FROM DAILY_PNL_ATTRIBUTION A
JOIN DAILY_CONTRACT_DATA C
  ON C.POSITION_ID = A.POSITION_ID
WHERE A.INSTRUMENT_TYPE IN ('FUTURES', 'OPTIONS')
AND A.EOD_DATE = (SELECT
  MIN(EOD_DATE)
FROM DAILY_PNL_ATTRIBUTION D
WHERE D.POSITION_REF = A.POSITION_REF
AND
   CASE
     WHEN D.INSTRUMENT_TYPE = 'FUTURES' AND
       ISNULL(D.CURRENT_FUT_MARKET_PRICE, 0) <> 0 THEN 1
     WHEN D.INSTRUMENT_TYPE = 'OPTIONS' AND
       ISNULL(D.CURRENT_OPT_MARKET_PREMIUM, 0) <> 0 THEN 1
   END = 1
AND D.POSITION_DATE <= $P{asofdate})
AND A.POSITION_DATE <= $P{asofdate}
AND A.EXPIRED_DATE >= DATEADD(yy, DATEDIFF(yy, 0, $P{asofdate}), 0)) X
LEFT JOIN (SELECT
  A.POSITION_REF,
  A.POSITION_DATE CONTRACT_DATE,
  A.POSITION_ID,
  A.INSTRUMENT_TYPE,
  A.CONTRACT_BOOK,
  A.EOD_DATE,
  A.EXPIRED_DATE,
   CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) SETTLEMENT_PRICE_POS_UOM,
  CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10))  / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE_RPT_UOM,
  CAST(CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) * CAST(A.CURRENT_POS_TO_RPT_FXRATE AS  numeric(19, 10)) AS  numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE,
  A.CURRENT_POS_TO_RPT_FXRATE
FROM DAILY_PNL_ATTRIBUTION A
JOIN DAILY_CONTRACT_DATA C
  ON C.POSITION_ID = A.POSITION_ID
WHERE A.INSTRUMENT_TYPE IN ('FUTURES', 'OPTIONS')
AND A.EOD_DATE = (SELECT
  MAX(EOD_DATE)
FROM DAILY_PNL_ATTRIBUTION D
WHERE D.EOD_DATE <= DATEADD(yy, DATEDIFF(yy, 0, $P{asofdate}), 0) - 1)
AND DATEPART(yyyy, A.POSITION_DATE) <= DATEPART(yyyy, $P{asofdate})) Y
  ON X.POSITION_REF = Y.POSITION_REF) FIRST_EOD
  ON PNL.POSITION_ID = FIRST_EOD.POSITION_ID
  AND PNL.INSTRUMENT_TYPE = FIRST_EOD.INSTRUMENT_TYPE
  AND PNL.CONTRACT_BOOK = FIRST_EOD.CONTRACT_BOOK
LEFT JOIN (SELECT
  A.POSITION_ID,
  A.INSTRUMENT_TYPE,
  A.CONTRACT_BOOK,
  A.EOD_DATE,
  A.PRICE_CHANGE_IMPACT,
  A.FOREX_SHIFT_IMPACT_WRT_PRICE,
  A.FOREX_SHIFT_IMPACT_WRT_BASIS,
  A.FOREX_SHIFT_IMPACT_WRT_BASIS_MARKET,
  A.FOREX_SHIFT_IMPACT_WRT_MARKET
FROM DAILY_PNL_ATTRIBUTION A
JOIN (SELECT
  MIN(A.EOD_DATE) AS EOD_DATE
FROM DAILY_PNL_ATTRIBUTION A
JOIN EXTRACTED_FINANCIAL_CALENDAR_DETAIL CD
  ON $P{asofdate} BETWEEN CD.START_DATE AND CD.END_DATE
  AND A.CONTRACT_BOOK IN (SELECT
    CONTRACT_BOOK
  FROM EXTRACTED_FINANCIAL_CALENDAR_HEADER CH
  WHERE CH.GROUP_ID = CD.GROUP_ID)
JOIN EXTRACTED_FINANCIAL_CALENDAR_HEADER CH
  ON CD.GROUP_ID = CH.GROUP_ID
  AND DATEPART(YEAR, $P{asofdate}) BETWEEN CH.START_YEAR AND CH.END_YEAR
  AND A.CONTRACT_BOOK = CH.CONTRACT_BOOK
JOIN BI_MONTHQUARTERMAPPING MTHMAP_START
  ON MTHMAP_START.MONTHNUMBER = ((CH.START_YEAR - 1) * 100) + CH.START_MONTH
JOIN BI_MONTHQUARTERMAPPING MTHMAP_END
  ON MTHMAP_END.MONTHNUMBER = ((CH.END_YEAR - 1) * 100) + CH.END_MONTH
WHERE A.EOD_DATE >= MTHMAP_START.STARTPERIOD
AND A.EOD_DATE <= MTHMAP_END.ENDPERIOD) B
  ON A.EOD_DATE = B.EOD_DATE) LAST_EOD
  ON PNL.POSITION_ID = LAST_EOD.POSITION_ID
  AND PNL.INSTRUMENT_TYPE = LAST_EOD.INSTRUMENT_TYPE
  AND PNL.CONTRACT_BOOK = LAST_EOD.CONTRACT_BOOK
WHERE PNL.INSTRUMENT_TYPE IN ('FUTURES', 'OPTIONS')
AND PNL.EOD_DATE <= $P{asofdate}
UNION ALL
SELECT
  PNL.CONTRACT_BOOK,
  CASE
    WHEN PNL.EXPIRED_DATE < CD.START_DATE THEN 'Booked Till Last Month End'
    ELSE 'Booked For The Month'
  END AS ALLOCATION_GROUP,
  CASE PNL.INSTRUMENT_TYPE
    WHEN 'FUTURES' THEN 'Futures'
    WHEN 'OPTIONS' THEN 'Options'
  END AS INSTRUMENT_TYPE,
  PNL.COMMODITY AS PRODUCT,
  PNL.PROFIT_CENTER AS UNIT,
  PNL.COUNTERPARTY AS EXCHANGE,
  PNL.POSITION_DATE AS DEAL_DATE,
  PNL.POSITION_REF AS COVER_NO,
  PNL.FUTURE_DELIVERY_MONTH AS TERMINAL_MONTH,
  PNL.FUTURE_DELIVERY_MONTHNUMBER AS TERMINAL_MONTH_NUMBER,
  PNL._CURRENT_QTY_RPT_UOM * PNL._POLARITY AS QTY,
  CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN  PNL._CURRENT_POS_PRICE_RPT_UOM
    ELSE FIRST_EOD.MARKET_RATE_RPT_UOM
  END AS CONTRACT_PRICE,
  PNL.POSITION_CURRENCY AS CCY,
  PNL._CURRENT_POS_TO_RPT_FXRATE AS CURRENT_FX_RATE,
  FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE AS YEAR_BEGINNING_FX_RATE,
  CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN (PNL._CURRENT_POSITION_PRICE + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))
    ELSE (FIRST_EOD.MARKET_RATE_POS_UOM + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))
  END * CAST(REALIZED_QTY AS numeric(19, 10)) * PNL._POLARITY AS REALIZED_VAL,
  NULL AS OPEN_VALUE,
  PNL._SETTLEMENT_PRICE_RPT_UOM AS SETTLEMENT_PRICE,
  FIRST_EOD.MARKET_RATE_RPT_UOM AS YEAR_BEGIN_MARKET_RATE,
  (PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM) - CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN PNL._CURRENT_POSITION_PRICE
    ELSE FIRST_EOD.MARKET_RATE_POS_UOM
  END) * PNL.REALIZED_QTY * PNL._POLARITY AS PERIOD_PNL,
  (((PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM)) * PNL._CURRENT_POS_TO_RPT_FXRATE) - CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN (PNL._CURRENT_POSITION_PRICE * PNL._CURRENT_POS_TO_RPT_FXRATE)
    ELSE (FIRST_EOD.MARKET_RATE_POS_UOM * PNL._CURRENT_POS_TO_RPT_FXRATE)
  END) * PNL.REALIZED_QTY * PNL._POLARITY AS PRICE_PNL,
  (PNL._CURRENT_POS_TO_RPT_FXRATE - FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE) * PNL.REALIZED_QTY * PNL._POLARITY * (CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN PNL._CURRENT_POSITION_PRICE
    ELSE FIRST_EOD.MARKET_RATE_POS_UOM
  END + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM)) AS FX_PNL,
    ((((PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM)) * PNL._CURRENT_POS_TO_RPT_FXRATE) - CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN (PNL._CURRENT_POSITION_PRICE * PNL._CURRENT_POS_TO_RPT_FXRATE)
    ELSE (FIRST_EOD.MARKET_RATE_POS_UOM * PNL._CURRENT_POS_TO_RPT_FXRATE)
  END) * PNL.REALIZED_QTY * PNL._POLARITY) + ((PNL._CURRENT_POS_TO_RPT_FXRATE - FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE) * PNL.REALIZED_QTY * PNL._POLARITY * (CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN PNL._CURRENT_POSITION_PRICE
    ELSE FIRST_EOD.MARKET_RATE_POS_UOM
  END  + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM))) AS PERIOD_PNL_RPT,
  ((PNL._SETTLEMENT_PRICE_POS_UOM - (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM) - PNL._CURRENT_POSITION_PRICE ) * PNL.REALIZED_QTY * PNL._POLARITY * PNL._CURRENT_POS_TO_RPT_FXRATE) +   (PNL._CURRENT_POS_TO_RPT_FXRATE - FIRST_EOD.CURRENT_POS_TO_RPT_FXRATE) * PNL.REALIZED_QTY * PNL._POLARITY * (CASE
    WHEN DATEPART(yyyy, PNL.POSITION_DATE) = DATEPART(yyyy, $P{asofdate}) THEN PNL._CURRENT_POSITION_PRICE
    ELSE FIRST_EOD.MARKET_RATE_POS_UOM END + (PNL._POLARITY * PNL._CURRENT_COST_POS_UOM)) AS PNL_FROM_DEAL_DATE,
  PNL.BASIS_MARKET_PRICE_INDEX,
  CASE
    WHEN ISNULL(PNL.PRICING_TYPE, 'PRICED') != 'PRICED' AND
      PNL.ALLOCATION_ID = PNL.PRICING_ID THEN 'BASIS'
    ELSE 'COMMODITY'
  END AS EVENT_TYPE,
  PNL.CALL_PUT,
  CASE
    WHEN PNL.EXPIRED_DATE < CD.START_DATE THEN 'Booked Till Last Month End'
    ELSE 'Booked For The Month'
  END AS ALLOCATION_GROUP1,
  NULL ALLOCATION_GROUP2
FROM (SELECT
  A.*,
  CAST(CURRENT_POSITION_PRICE AS numeric(19, 10)) _CURRENT_POSITION_PRICE,
  CAST(CURRENT_POS_TO_RPT_FXRATE AS numeric(19, 10)) _CURRENT_POS_TO_RPT_FXRATE,
  ISNULL(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END, 0) AS _CURRENT_MARKET_PRICE,
  (CAST(A.CURRENT_POSITION_QUANTITY AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_POS_TO_RPT, 1) AS numeric(19, 10))) - COALESCE(EOD_QTY.MATCHED_QUANTITY,0) AS _CURRENT_QTY_RPT_UOM,
  CURRENT_POSITION_QUANTITY - COALESCE((EOD_QTY.MATCHED_QUANTITY / A.UOM_FACTOR_FROM_POS_TO_RPT),0) REALIZED_QTY,
  CASE
    WHEN A.LONG_SHORT = 'SHORT' THEN -1
    ELSE 1
  END AS _POLARITY,
  CAST(A.CURRENT_POSITION_PRICE / COALESCE(A.UOM_FACTOR_FROM_POS_TO_RPT, 1) AS numeric(19, 10)) AS _CURRENT_POS_PRICE_RPT_UOM,
  CAST((COALESCE(A.CURRENT_FREIGHT_COST, 0)
  + COALESCE(A.CURRENT_OTHER_COST, 0)) / COALESCE(A.UOM_FACTOR_FROM_POS_TO_RPT, 1) AS numeric(19, 10)) AS _CURRENT_COST_RPT_UOM,
  CAST((COALESCE(A.CURRENT_FREIGHT_COST, 0)
  + COALESCE(A.CURRENT_OTHER_COST, 0)) AS numeric(19, 10)) AS _CURRENT_COST_POS_UOM,
  CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) AS _SETTLEMENT_PRICE_POS_UOM,
  CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) _SETTLEMENT_PRICE_RPT_UOM,
  CAST(CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) * CAST(A.CURRENT_POS_TO_RPT_FXRATE AS numeric(19, 10)) AS numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) AS _SETTLEMENT_PRICE
FROM DAILY_PNL_ATTRIBUTION A
JOIN DAILY_CONTRACT_DATA C
  ON C.POSITION_ID = A.POSITION_ID
LEFT JOIN (SELECT
  POSITION_ID,
  INSTRUMENT_TYPE,
  REPORT_DATE,
  SUM(MATCHED_QUANTITY) AS MATCHED_QUANTITY
FROM (SELECT
  REPORT_DATE AS REPORT_DATE,
  SALES_ID AS POSITION_ID,
  SALES_EOD_DATE AS EOD_DATE,
  'Futures' AS INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_FUTURES
UNION ALL
SELECT
  REPORT_DATE REPORT_DATE,
  PURCHASE_ID POSITION_ID,
  PURCH_EOD_DATE EOD_DATE,
  'Futures' INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_FUTURES
UNION ALL
SELECT
  REPORT_DATE REPORT_DATE,
  SALES_ID POSITION_ID,
  SALES_EOD_DATE EOD_DATE,
  'Options' INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_OPTIONS
UNION ALL
SELECT
  REPORT_DATE REPORT_DATE,
  PURCHASE_ID POSITION_ID,
  PURCH_EOD_DATE EOD_DATE,
  'Options' INSTRUMENT_TYPE,
  MATCH_QTY AS MATCHED_QUANTITY
FROM DUMP_BI_FIFO_MATCH_OPTIONS) X
WHERE X.REPORT_DATE = DATEADD(yy, DATEDIFF(yy, 0, $P{asofdate}), 0) - 1
GROUP BY POSITION_ID,
         INSTRUMENT_TYPE,
         REPORT_DATE) EOD_QTY
  ON EOD_QTY.POSITION_ID = A.POSITION_ID
  AND UPPER(EOD_QTY.INSTRUMENT_TYPE) = UPPER(A.INSTRUMENT_TYPE)
WHERE (CAST(A.CURRENT_POSITION_QUANTITY AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_POS_TO_RPT, 1) AS numeric(19, 10))) - COALESCE(EOD_QTY.MATCHED_QUANTITY,0) > 0  ) PNL
JOIN DAILY_CONTRACT_DATA C
  ON C.POSITION_ID = PNL.POSITION_ID
  AND PNL.EOD_DATE = (SELECT
    MAX(EOD_DATE)
  FROM DAILY_PNL_ATTRIBUTION DPA
  WHERE DPA.POSITION_REF = PNL.POSITION_REF)
  AND DATEPART(yyyy, PNL.EXPIRED_DATE) = DATEPART(yyyy, $P{asofdate})
  AND PNL.EXPIRED_DATE <= $P{asofdate}
JOIN EXTRACTED_FINANCIAL_CALENDAR_DETAIL CD
  ON $P{asofdate} BETWEEN CD.START_DATE AND CD.END_DATE
  AND PNL.CONTRACT_BOOK IN (SELECT
    CONTRACT_BOOK
  FROM EXTRACTED_FINANCIAL_CALENDAR_HEADER CH
  WHERE CH.GROUP_ID = CD.GROUP_ID)
LEFT JOIN (SELECT DISTINCT
  POSITION_ID
FROM DAILY_PNL_REALIZATION) R
  ON PNL.POSITION_ID = R.POSITION_ID
LEFT JOIN (SELECT
  X.POSITION_ID,
  X.INSTRUMENT_TYPE,
  X.CONTRACT_BOOK,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.SETTLEMENT_PRICE
    ELSE Y.SETTLEMENT_PRICE
  END MARKET_RATE,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.SETTLEMENT_PRICE_POS_UOM
    ELSE Y.SETTLEMENT_PRICE_POS_UOM
  END MARKET_RATE_POS_UOM,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.SETTLEMENT_PRICE_RPT_UOM
    ELSE Y.SETTLEMENT_PRICE_RPT_UOM
  END MARKET_RATE_RPT_UOM,
  CASE
    WHEN DATEPART(yyyy, X.CONTRACT_DATE) = DATEPART(yyyy, $P{asofdate}) THEN X.CURRENT_POS_TO_RPT_FXRATE
    ELSE Y.CURRENT_POS_TO_RPT_FXRATE
  END CURRENT_POS_TO_RPT_FXRATE,
  Y.SETTLEMENT_PRICE EOD_MARKET_PRICE_RPT_UOM,
  Y.SETTLEMENT_PRICE_POS_UOM EOD_MARKET_PRICE_POS_UOM,
  Y.CURRENT_POS_TO_RPT_FXRATE EOD_CURRENT_POS_TO_RPT_FXRATE
FROM (SELECT
  A.POSITION_REF,
  A.POSITION_ID,
  A.INSTRUMENT_TYPE,
  A.CONTRACT_BOOK,
  A.POSITION_DATE CONTRACT_DATE,
  A.EOD_DATE,
  A.EXPIRED_DATE,
  CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) SETTLEMENT_PRICE_POS_UOM,
  CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE_RPT_UOM,
  CAST(CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) * CAST(A.CURRENT_POS_TO_RPT_FXRATE AS numeric(19, 10)) AS numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE,
  A.CURRENT_POS_TO_RPT_FXRATE
FROM DAILY_PNL_ATTRIBUTION A
JOIN DAILY_CONTRACT_DATA C
  ON C.POSITION_ID = A.POSITION_ID
WHERE A.INSTRUMENT_TYPE IN ('FUTURES', 'OPTIONS')
AND A.EOD_DATE = (SELECT
  MIN(EOD_DATE)
FROM DAILY_PNL_ATTRIBUTION D
WHERE D.POSITION_REF = A.POSITION_REF
AND
   CASE
     WHEN D.INSTRUMENT_TYPE = 'FUTURES' AND
       ISNULL(D.CURRENT_FUT_MARKET_PRICE, 0) <> 0 THEN 1
     WHEN D.INSTRUMENT_TYPE = 'OPTIONS' AND
       ISNULL(D.CURRENT_OPT_MARKET_PREMIUM, 0) <> 0 THEN 1
   END = 1
AND D.POSITION_DATE <= $P{asofdate})
AND A.POSITION_DATE <= $P{asofdate}
AND A.EXPIRED_DATE >= DATEADD(yy, DATEDIFF(yy, 0, $P{asofdate}), 0)) X
LEFT JOIN (SELECT
  A.POSITION_REF,
  A.POSITION_DATE CONTRACT_DATE,
  A.POSITION_ID,
  A.INSTRUMENT_TYPE,
  A.CONTRACT_BOOK,
  A.EOD_DATE,
  A.EXPIRED_DATE,
  CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) SETTLEMENT_PRICE_POS_UOM,
  CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE_RPT_UOM,
  CAST(CAST(CAST(CAST(ISNULL(CAST(CASE
    WHEN A.INSTRUMENT_TYPE = 'FUTURES' THEN A.CURRENT_FUT_MARKET_PRICE
    WHEN A.INSTRUMENT_TYPE = 'OPTIONS' THEN A.CURRENT_OPT_MARKET_PREMIUM
  END AS numeric(19, 10)), 0) * CAST(A.CURRENT_MKT_TO_POS_FXRATE AS numeric(19, 10)) AS numeric(19, 10))
  / CAST(CAST(ISNULL(C.DENOMINATION_FACTOR, 1) AS numeric(19, 10)) * CAST(ISNULL(A.UOM_FACTOR_FROM_MKT_TO_POS, 1) AS numeric(19, 10)) AS numeric(19, 10)) AS numeric(19, 10)) * CAST(A.CURRENT_POS_TO_RPT_FXRATE AS numeric(19, 10)) AS numeric(19, 10)) / A.UOM_FACTOR_FROM_POS_TO_RPT AS numeric(19, 10)) SETTLEMENT_PRICE,
  A.CURRENT_POS_TO_RPT_FXRATE
FROM DAILY_PNL_ATTRIBUTION A
JOIN DAILY_CONTRACT_DATA C
  ON C.POSITION_ID = A.POSITION_ID
WHERE A.INSTRUMENT_TYPE IN ('FUTURES', 'OPTIONS')
AND A.EOD_DATE = (SELECT
  MAX(EOD_DATE)
FROM DAILY_PNL_ATTRIBUTION D
WHERE D.EOD_DATE <= DATEADD(yy, DATEDIFF(yy, 0, $P{asofdate}), 0) - 1)
AND DATEPART(yyyy, A.POSITION_DATE) <= DATEPART(yyyy, $P{asofdate})) Y
  ON X.POSITION_REF = Y.POSITION_REF) FIRST_EOD
  ON PNL.POSITION_ID = FIRST_EOD.POSITION_ID
  AND PNL.INSTRUMENT_TYPE = FIRST_EOD.INSTRUMENT_TYPE
  AND PNL.CONTRACT_BOOK = FIRST_EOD.CONTRACT_BOOK
LEFT JOIN (SELECT
  A.POSITION_ID,
  A.INSTRUMENT_TYPE,
  A.CONTRACT_BOOK,
  A.EOD_DATE,
  A.PRICE_CHANGE_IMPACT,
  A.FOREX_SHIFT_IMPACT_WRT_PRICE,
  A.FOREX_SHIFT_IMPACT_WRT_BASIS,
  A.FOREX_SHIFT_IMPACT_WRT_BASIS_MARKET,
  A.FOREX_SHIFT_IMPACT_WRT_MARKET
FROM DAILY_PNL_ATTRIBUTION A
JOIN (SELECT
  MIN(A.EOD_DATE) AS EOD_DATE
FROM DAILY_PNL_ATTRIBUTION A
JOIN EXTRACTED_FINANCIAL_CALENDAR_DETAIL CD
  ON $P{asofdate} BETWEEN CD.START_DATE AND CD.END_DATE
  AND A.CONTRACT_BOOK IN (SELECT
    CONTRACT_BOOK
  FROM EXTRACTED_FINANCIAL_CALENDAR_HEADER CH
  WHERE CH.GROUP_ID = CD.GROUP_ID)
JOIN EXTRACTED_FINANCIAL_CALENDAR_HEADER CH
  ON CD.GROUP_ID = CH.GROUP_ID
  AND DATEPART(YEAR, $P{asofdate}) BETWEEN CH.START_YEAR AND CH.END_YEAR
  AND A.CONTRACT_BOOK = CH.CONTRACT_BOOK
JOIN BI_MONTHQUARTERMAPPING MTHMAP_START
  ON MTHMAP_START.MONTHNUMBER = ((CH.START_YEAR - 1) * 100) + CH.START_MONTH
JOIN BI_MONTHQUARTERMAPPING MTHMAP_END
  ON MTHMAP_END.MONTHNUMBER = ((CH.END_YEAR - 1) * 100) + CH.END_MONTH
WHERE A.EOD_DATE >= MTHMAP_START.STARTPERIOD
AND A.EOD_DATE <= MTHMAP_END.ENDPERIOD) B
  ON A.EOD_DATE = B.EOD_DATE) LAST_EOD
  ON PNL.POSITION_ID = LAST_EOD.POSITION_ID
  AND PNL.INSTRUMENT_TYPE = LAST_EOD.INSTRUMENT_TYPE
  AND PNL.CONTRACT_BOOK = LAST_EOD.CONTRACT_BOOK
WHERE PNL.INSTRUMENT_TYPE IN ('FUTURES', 'OPTIONS')
AND PNL.EOD_DATE <= $P{asofdate})L1
WHERE $X{IN,CONTRACT_BOOK,ctrbook}
AND  $X{IN,EXCHANGE,exchange}
AND $X{IN,UNIT,pc}
AND  $X{IN,TERMINAL_MONTH,tmonth}
AND  $X{IN,PRODUCT,commodity}

AND ((L1.EVENT_TYPE = 'BASIS') OR L1.EVENT_TYPE = 'COMMODITY')

ORDER  BY DEAL_DATE,
          COVER_NO]]>
		</queryString>
		<field name="CONTRACT_BOOK" class="java.lang.String"/>
		<field name="ALLOCATION_GROUP" class="java.lang.String"/>
		<field name="INSTRUMENT_TYPE" class="java.lang.String"/>
		<field name="PRODUCT" class="java.lang.String"/>
		<field name="UNIT" class="java.lang.String"/>
		<field name="EXCHANGE" class="java.lang.String"/>
		<field name="DEAL_DATE" class="java.sql.Date"/>
		<field name="COVER_NO" class="java.lang.String"/>
		<field name="TERMINAL_MONTH" class="java.lang.String"/>
		<field name="TERMINAL_MONTH_NUMBER" class="java.lang.Integer"/>
		<field name="QTY" class="java.math.BigDecimal"/>
		<field name="CONTRACT_PRICE" class="java.math.BigDecimal"/>
		<field name="CCY" class="java.lang.String"/>
		<field name="CURRENT_FX_RATE" class="java.math.BigDecimal"/>
		<field name="YEAR_BEGINNING_FX_RATE" class="java.math.BigDecimal"/>
		<field name="REALIZED_VAL" class="java.math.BigDecimal"/>
		<field name="OPEN_VALUE" class="java.math.BigDecimal"/>
		<field name="SETTLEMENT_PRICE" class="java.math.BigDecimal"/>
		<field name="YEAR_BEGIN_MARKET_RATE" class="java.math.BigDecimal"/>
		<field name="PERIOD_PNL" class="java.math.BigDecimal"/>
		<field name="PRICE_PNL" class="java.math.BigDecimal"/>
		<field name="FX_PNL" class="java.math.BigDecimal"/>
		<field name="PERIOD_PNL_RPT" class="java.math.BigDecimal"/>
		<field name="PNL_FROM_DEAL_DATE" class="java.math.BigDecimal"/>
		<field name="BASIS_MARKET_PRICE_INDEX" class="java.lang.String"/>
		<field name="EVENT_TYPE" class="java.lang.String"/>
		<field name="CALL_PUT" class="java.lang.String"/>
		<field name="ALLOCATION_GROUP1" class="java.lang.String"/>
		<field name="ALLOCATION_GROUP2" class="java.lang.String"/>
		<variable name="QTY" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{QTY}]]></variableExpression>
		</variable>
		<variable name="REALIZED_VAL" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{REALIZED_VAL}]]></variableExpression>
		</variable>
		<variable name="OPEN_VALUE" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{OPEN_VALUE}]]></variableExpression>
		</variable>
		<variable name="PERIOD_PNL" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{PERIOD_PNL}]]></variableExpression>
		</variable>
		<variable name="PRICE_PNL" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{PRICE_PNL}]]></variableExpression>
		</variable>
		<variable name="FX_PNL" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{FX_PNL}]]></variableExpression>
		</variable>
		<variable name="PERIOD_PNL_RPT" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{PERIOD_PNL_RPT}]]></variableExpression>
		</variable>
		<variable name="PNL_DEAL_DATE" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{PNL_FROM_DEAL_DATE}]]></variableExpression>
		</variable>
	</subDataset>
	<parameter name="ctrbook" class="java.util.Collection"/>
	<parameter name="asofdate" class="java.util.Date"/>
	<parameter name="exchange" class="java.util.Collection"/>
	<parameter name="commodity" class="java.util.Collection"/>
	<parameter name="tmonth" class="java.util.Collection"/>
	<parameter name="pc" class="java.util.Collection"/>
	<parameter name="month_name" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT 1 AS ID]]>
	</queryString>
	<field name="ID" class="java.lang.Integer"/>
	<variable name="currentpage" class="java.lang.Integer" resetType="Page" incrementType="Page">
		<initialValueExpression><![CDATA[$V{PAGE_NUMBER}]]></initialValueExpression>
	</variable>
	<pageHeader>
		<band height="60" splitType="Stretch">
			<property name="local_mesure_unitheight" value="pixel"/>
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<image scaleImage="FillFrame" onErrorType="Blank">
				<reportElement mode="Opaque" x="0" y="0" width="30" height="30" backcolor="#1F497D" uuid="b5453d11-c0b7-48a7-b4d2-2098d19d418d">
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					<property name="net.sf.jasperreports.export.xls.column.width.ratio" value="1.15"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
				</box>
				<imageExpression><![CDATA["repo:olam.png"]]></imageExpression>
			</image>
			<textField>
				<reportElement mode="Opaque" x="30" y="0" width="1500" height="30" forecolor="#FFFFFF" backcolor="#1F497D" uuid="34e02260-8f0d-4e75-b409-59a579348dbd">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box leftPadding="10" rightPadding="2">
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.0" lineColor="#4F81BD"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="13" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Book Value Futures Report as of - " + DATEFORMAT($P{asofdate}, "dd-MMM-yy")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement mode="Opaque" x="1530" y="0" width="270" height="30" forecolor="#FFFFFF" backcolor="#1F497D" uuid="9af73300-0c15-4af3-873a-7a570064ee21">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.0" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="13" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Run Date : "+DATEFORMAT(TODAY( ),"dd-MMM-yy h:mm:ss a")]]></textFieldExpression>
			</textField>
			<textField pattern="">
				<reportElement mode="Opaque" x="0" y="30" width="1800" height="30" forecolor="#FFFFFF" backcolor="#1F497D" uuid="ff3c2db8-c988-44f1-8bce-cd3ad0091517">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="13" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Unit : "+(!$P{pc}.isEmpty()? $P{pc}.toString():"All")+"  "+"Contract Book : "+(!$P{ctrbook}.isEmpty()? $P{ctrbook}.toString():"All")+"  "+"Exchange : "+(!$P{exchange}.isEmpty()? $P{exchange}.toString():"All")+"  "+"Commodity : "+(!$P{commodity}.isEmpty()? $P{commodity}.toString():"All")+"  "+"Terminal Month : "+(!$P{tmonth}.isEmpty()? $P{tmonth}.toString():"All")]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band splitType="Stretch">
			<property name="local_mesure_unitheight" value="pixel"/>
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
		</band>
	</columnHeader>
	<detail>
		<band height="90" splitType="Stretch">
			<property name="local_mesure_unitheight" value="pixel"/>
			<componentElement>
				<reportElement key="table 2" style="table 2" x="0" y="0" width="1800" height="90" uuid="ec9a8af4-4e3d-493d-9c52-12b332026941"/>
				<jr:table xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
					<datasetRun subDataset="derivatives" uuid="ab5f2549-e4ff-4ce7-99c9-6ff42f269c70">
						<datasetParameter name="ctrbook">
							<datasetParameterExpression><![CDATA[$P{ctrbook}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="asofdate">
							<datasetParameterExpression><![CDATA[$P{asofdate}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="commodity">
							<datasetParameterExpression><![CDATA[$P{commodity}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="exchange">
							<datasetParameterExpression><![CDATA[$P{exchange}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="tmonth">
							<datasetParameterExpression><![CDATA[$P{tmonth}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="pc">
							<datasetParameterExpression><![CDATA[$P{pc}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="month_name">
							<datasetParameterExpression><![CDATA[$P{month_name}]]></datasetParameterExpression>
						</datasetParameter>
						<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					</datasetRun>
					<jr:column width="90" uuid="a5564b98-0ce0-457d-b5d6-d6939a359944">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="a5bd241b-4513-457f-81df-c70cf4ddefeb"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Product]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement x="0" y="0" width="90" height="30" uuid="d3fbd3da-4311-4fcf-a804-39bdfe128523"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<text><![CDATA[Total]]></text>
							</staticText>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="e91f5755-3563-4cc7-914d-bbbc7ef28a52"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PRODUCT}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="165b71c1-ef61-4cb3-bce3-fcfc0e79c6ef">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="1ac17e6f-b533-419b-8f25-3cda06f5d5c6"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Unit]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="44b14f8a-af26-40ed-a7d7-0fc81cbc2ebb"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{UNIT}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="e073b2dd-8419-4b61-83f6-123ec5826bc3">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="6f2e0a36-b0ce-492e-a3ac-768277dd0cc0"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Exchange]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="fb43aae6-85d6-46ef-b039-fd3d45c39631"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{EXCHANGE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="b92c3c58-c4e5-48c1-8a34-abecaaec9b93">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="41830083-3c00-499a-bd4d-9e719e8536d5"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Deal Date]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="dd-MMM-yy" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="df2fa301-5e5b-4f6c-b82b-ca987b074704"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{DEAL_DATE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="5e746d97-ad6c-4b7d-b285-e38be231b442">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="ea685e10-a38a-4b43-aaed-6c3efbb727c4"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Trade #]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="f203f23d-674f-49db-900c-40cd00323160"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{COVER_NO}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="bd7b9d5a-e812-42c4-ac46-c969039fe3ec">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="c6be36fa-4750-4459-bde3-69881fab2423"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Terminal Month]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="b5ce8180-13e8-4680-b12b-209dedc562e1"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{TERMINAL_MONTH}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="e49dd3f9-9a43-4900-a49a-dfdfe11ffce1">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="2e49abc7-99d3-459b-9e75-b76f98cec2aa"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Qty (MT)]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="9f437500-6aa6-4623-8a41-248c3fc2fa74"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{QTY}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="272d098e-48f9-429b-8395-11c4e25e8b28">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{QTY}.intValue() < 0 ? $V{QTY} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="b157e130-2e58-4b7f-91a7-681cb440564f"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{QTY}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="6fb40175-5b37-490a-9fb3-6c46fc23569d">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{QTY}.intValue() < 0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{QTY}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="5de13f7a-08dc-480c-b21d-f65b2a37402d">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="3bcc372c-801d-44d2-a5e3-b97316951dce"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Contract Price]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="aaf99115-2f30-4887-a517-633c5810adf0"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{CONTRACT_PRICE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="c1fb7575-8047-4649-bb4b-ffe57cf5ae74">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{CONTRACT_PRICE}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{CONTRACT_PRICE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="656588fb-c621-4e7e-9a1c-1adead2e10c1">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="d61068f6-2f66-4f6b-864c-45fbe6336dc5"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Ccy]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="377b1385-fbae-47b2-a1c8-debe197d526b"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{CCY}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="25375b3b-748f-460a-93e5-960ae65292f3">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="09501f78-3524-454d-9c34-7a5739e8dd1f"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Current Fx Rate]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.0000;(#,##0.0000)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="43b0ec19-eb3e-4fc5-88e2-9af1d58848e8"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{CURRENT_FX_RATE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.0000;(#,##0.0000)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="0f42bc1e-65f2-4811-889f-7194eaefc9b2">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{CURRENT_FX_RATE}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{CURRENT_FX_RATE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="226aa400-b4aa-4969-97d8-e59a3077a8d8">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="2afc764a-318d-4e62-8be9-a751b4e81ba0"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Year Beginning Fx Rate]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.0000;(#,##0.0000)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="0b488f3d-08a7-4c99-8a20-42d9e61a82d7"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{YEAR_BEGINNING_FX_RATE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.0000;(#,##0.0000)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="dbff4292-ade2-4984-a003-e6006587527b">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{YEAR_BEGINNING_FX_RATE}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{YEAR_BEGINNING_FX_RATE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="e7c2088b-b527-451d-9add-6732ae4b3983">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="eb6e019c-0d72-4cde-8273-1a07d2483990"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Realized Val (Local Ccy)]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="1c059f83-7963-413a-88b8-b5847830ec4e"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{REALIZED_VAL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="de0e94da-dfac-4d41-a8b9-afc8e5919460">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{REALIZED_VAL}.intValue() < 0 ? $V{REALIZED_VAL} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="87b12ba0-ef3e-433b-91f2-70d3ba5295a9"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{REALIZED_VAL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="5b335b0a-dfbd-4d7d-aab8-b118dd84f316">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{REALIZED_VAL}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{REALIZED_VAL}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="3e818305-a661-4a07-a158-97ba5b473e99">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="61616e7c-42d9-4d76-838b-ca45d4abab4b"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Open Value]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="26daf3f6-0603-4c7f-80f3-226a82535b82"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{OPEN_VALUE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="0e1b5e27-8f15-41df-a00b-4919b57abb4c">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{OPEN_VALUE}.intValue() < 0 ? $V{OPEN_VALUE} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="5d3f5bf8-2d4d-4c98-8b0d-e68afc082203"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{OPEN_VALUE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="c6d7d29e-7739-4626-bed6-7c1e3f2ad771">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{OPEN_VALUE}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{OPEN_VALUE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="2fbecfc0-9721-423c-b546-4f750cc5a8c9">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="2a49070c-b0da-431f-81b3-8616067aee11"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Settlement Price]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="b7ddb678-a1be-4df1-b266-8c949f67b51f"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{SETTLEMENT_PRICE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="9904d7c5-02a0-4a70-af76-91695070c726">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{SETTLEMENT_PRICE}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{SETTLEMENT_PRICE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="e18b966f-18c0-45f5-9348-23b0f8e983dc">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="cb744c49-648e-4a21-bf73-6a2a8b4e06cc"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Year Begin Market Price]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="d97d8ef4-d9c6-40c2-bc9c-992c69a18426"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{YEAR_BEGIN_MARKET_RATE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="10afb79b-af50-40e9-b135-2db49b269674">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{YEAR_BEGIN_MARKET_RATE}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{YEAR_BEGIN_MARKET_RATE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="7e1ff229-8735-4fe5-8dae-4a674ec028e8">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="55cb9722-34c9-40ad-9f39-ba8e97cd6c0d"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Period PnL]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="2951b8ef-6006-4267-9c6a-7d7261692856"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PERIOD_PNL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="7e58ed8d-cf19-4560-8f14-a41c35607c72">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PERIOD_PNL}.intValue() < 0 ? $V{PERIOD_PNL} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="4e624f84-2338-45c8-bebb-ef1ba0e30729"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PERIOD_PNL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="c3bfea1f-ad77-4abf-bc62-e91967900e9d">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{PERIOD_PNL}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PERIOD_PNL}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="a67784f0-8f82-478b-a4bd-9517434075d2">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="e2c0d2c6-77a4-4c93-8374-8dcc879fc572"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Price PnL]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="ef8bd90e-2a54-40ef-bded-188a362bbb14"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PRICE_PNL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="cabc4a17-a678-46c7-84c1-56c7d1b7780c">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PRICE_PNL}.intValue() < 0 ? $V{PRICE_PNL} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="7bedd93d-d20b-42e3-80d9-49e161351b6f"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PRICE_PNL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="60d7c654-c916-4479-acab-9691bcc8d2a8">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{PRICE_PNL}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PRICE_PNL}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="53464378-4582-40bf-aeda-f9b5813723a5">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="7fb1d854-bf3f-41ac-b16d-9cd67db52e4e"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[FX PnL]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="9f58e33a-f57a-4c96-af98-7047752217d5"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{FX_PNL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="3f7b2a9b-6fc7-4f62-a28b-7b19e3876871">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{FX_PNL}.intValue() < 0 ? $V{FX_PNL} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="08259c7e-fa8c-468d-875f-0799a17c1211"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{FX_PNL}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="460818e9-234c-43c2-a403-60ab99ed2a2e">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{FX_PNL}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{FX_PNL}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="ecbf7d9d-808f-40b1-9cc7-2931cbbc215c">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="4d57f8e3-94f0-4ed4-8ca9-830b5cf1788b"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[Period PnL (USD)]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="6c0f3ebd-9001-4963-9510-a95169e4c0d1"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PERIOD_PNL_RPT}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="1a65c7d0-d62d-4ef2-93d9-83b1819758f8">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PERIOD_PNL_RPT}.intValue() < 0 ? $V{PERIOD_PNL_RPT} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="8fd8dd75-37e8-47ba-ac52-378ceb50eac6"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PERIOD_PNL_RPT}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="48d29f21-f92c-4953-b776-9e362d2d7700">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{PERIOD_PNL_RPT}.intValue()<0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PERIOD_PNL_RPT}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
					<jr:column width="90" uuid="34897b0d-4c35-4983-8be6-be8e91999bb9">
						<jr:columnHeader style="table_CH" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement mode="Opaque" x="0" y="0" width="90" height="30" backcolor="#8DB4E2" uuid="72b64a0c-3d95-4f93-a7f8-315f6c46bd35"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" isBold="true"/>
								</textElement>
								<text><![CDATA[PnL from deal date]]></text>
							</staticText>
						</jr:columnHeader>
						<jr:columnFooter style="Table_CH" height="30">
							<box>
								<topPen lineWidth="0.5" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="8703d0c6-2099-4a9d-9386-a373e4b1294f"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PNL_DEAL_DATE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="866c32ea-47c5-48d5-b61a-1e81d65e7b91">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PNL_DEAL_DATE}.intValue() < 0 ? $V{PNL_DEAL_DATE} : null]]></textFieldExpression>
							</textField>
						</jr:columnFooter>
						<jr:detailCell style="table 2_TD" height="30">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" uuid="315c63e0-114a-4ce7-8986-fb4308fe099c"/>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PNL_FROM_DEAL_DATE}]]></textFieldExpression>
							</textField>
							<textField pattern="#,##0.00;(#,##0.00)" isBlankWhenNull="true">
								<reportElement x="0" y="0" width="90" height="30" forecolor="#FF0000" uuid="ce3b0795-da1f-40ac-b0fc-44d445258ab2">
									<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
									<printWhenExpression><![CDATA[$F{PNL_FROM_DEAL_DATE}.intValue() < 0]]></printWhenExpression>
								</reportElement>
								<box leftPadding="4" rightPadding="4"/>
								<textElement textAlignment="Right" verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$F{PNL_FROM_DEAL_DATE}]]></textFieldExpression>
							</textField>
						</jr:detailCell>
					</jr:column>
				</jr:table>
			</componentElement>
		</band>
	</detail>
	<pageFooter>
		<band height="20" splitType="Stretch">
			<property name="local_mesure_unitheight" value="pixel"/>
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<textField evaluationTime="Auto">
				<reportElement positionType="Float" x="1530" y="0" width="90" height="20" uuid="a4e9b26e-a143-4523-91ef-6262d08988c7"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["Page " + ($V{currentpage} == null? 1 : $V{currentpage} + 1) + " of " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
