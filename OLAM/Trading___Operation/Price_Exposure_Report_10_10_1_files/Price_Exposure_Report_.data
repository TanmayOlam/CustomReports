<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Price_Exposure_Report" language="groovy" pageWidth="1684" pageHeight="1190" orientation="Landscape" columnWidth="1644" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="15a34c22-972b-40ea-9a95-0280ac0deb44">
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="7"/>
	<property name="net.sf.jasperreports.export.xls.font.size.fix.enabled" value="false"/>
	<property name="net.sf.jasperreports.export.xls.ignore.graphics" value="false"/>
	<property name="net.sf.jasperreports.export.xls.fit.width" value="1"/>
	<property name="net.sf.jasperreports.export.pdf.size.page.to.content" value="true"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<style name="Crosstab_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 2_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 2_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 2_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 2_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 3_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 3_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 3_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 3_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 4_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 4_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 4_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 4_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 5_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 5_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 5_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 5_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 6_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 6_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 6_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 6_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 7_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 7_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 7_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 7_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 8_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 8_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 8_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 8_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<subDataset name="profitcenter" uuid="d5c0fc8e-5e14-4092-a4bc-f99d6c612f46">
		<property name="com.jaspersoft.studio.data.defaultdataadapter" value="QA"/>
		<parameter name="date_from" class="java.util.Date"/>
		<parameter name="date_to" class="java.util.Date"/>
		<parameter name="pc" class="java.util.Collection"/>
		<parameter name="cmd" class="java.util.Collection"/>
		<parameter name="cbk" class="java.util.Collection"/>
		<parameter name="LE_Filter" class="java.lang.String">
			<parameterDescription><![CDATA[]]></parameterDescription>
			<defaultValueExpression><![CDATA[$P{LE_Filter}]]></defaultValueExpression>
		</parameter>
		<parameter name="QSTR_Filter" class="java.lang.String" isForPrompting="false">
			<defaultValueExpression><![CDATA[" AND CONTRACT_BOOK IN ('" + $P{LE_Filter} + "')"]]></defaultValueExpression>
		</parameter>
		<parameter name="asofdate" class="java.util.Date">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<parameter name="origindate" class="java.util.Date">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<queryString>
			<![CDATA[SELECT  --ISNULL(T1.COMMODITY,T2.COMMODITY) AS COMMODITY,
		T2.PROFIT_CENTER AS PROFIT_CENTER,
	   --COALESCE(T2.asofdate,T2.origindate,T1.ATTRIBUTION_DATE) AS
	   T2.asofdate AS ATTRIBUTION_DATE,
       QTY,
       ABS_QTY,
       CATEGORY,
	   --T1.TYPE_OF_DATA,
       ORDERBY
FROM  (SELECT  distinct eod.CONTRACT_BOOK CONTRACT_BOOK,
						PROFIT_CENTER,
						COMMODITY,
						eod.EOD_DATE  asofdate,
						(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
							FROM DM_POSITION_DATA DPD
							WHERE DPD.CONTRACT_BOOK = eod.CONTRACT_BOOK
							AND DPD.REPORT_DATE <= eod.EOD_DATE
							AND DPD.PROFIT_CENTER = eod.PROFIT_CENTER
							--AND DPD.MATERIAL_GROUP = eod.COMMODITY
							) origindate
				FROM (
						SELECT DISTINCT DPA.CONTRACT_BOOK
										,DPA.PROFIT_CENTER
										,DPA.COMMODITY
			  							,DPA.EOD_DATE
							FROM DAILY_PNL_ATTRIBUTION DPA
							JOIN (SELECT distinct EOD_DATE
									FROM   DAILY_PNL_ATTRIBUTION B
									WHERE $X{IN,CONTRACT_BOOK,cbk}
									AND B.EOD_DATE >= $P{date_from}
									AND B.EOD_DATE <= $P{date_to}
									AND $X{IN,PROFIT_CENTER,pc}
									AND $X{IN,COMMODITY,cmd}
									) BVBV
							ON DPA.EOD_DATE = BVBV.EOD_DATE
							AND  $X{IN, DPA.CONTRACT_BOOK, cbk}
							AND $X{IN,PROFIT_CENTER,pc}
							AND $X{IN,COMMODITY,cmd}

					) eod
				WHERE 0=0
				$P!{QSTR_Filter}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,COMMODITY,cmd}
	)T2
	RIGHT JOIN
	(
SELECT PROFIT_CENTER,

       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(ABS_QTY) AS ABS_QTY,
       CATEGORY,
       ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT A.PROFIT_CENTER,
               A.ATTRIBUTION_DATE,
               A.QTY,
               Abs(A.QTY)     AS ABS_QTY,
               'Origin Stock' AS CATEGORY,
               0              AS ORDERBY,
               'Origin'              AS TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,
                       REPORT_DATE    AS ATTRIBUTION_DATE,
                       Sum(QUANTITY)  AS QTY
                FROM   DM_POSITION_DATA
                WHERE  ORIGIN_DATA_TYPE = 'IV'
				AND	   0=0
                AND $X{IN,MATERIAL_GROUP,cmd}

        AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          REPORT_DATE) A
        WHERE  ATTRIBUTION_DATE >= $P{date_from}
               AND ATTRIBUTION_DATE <= $P{date_to}
             AND $X{IN,PROFIT_CENTER,pc}

         AND A.QTY <> 0
        UNION
        SELECT COALESCE(A.PROFIT_CENTER, B.PROFIT_CENTER)               AS PROFIT_CENTER,

               COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               Isnull(A.QTY, 0) - Isnull(B.QTY, 0)              AS QTY,
               Abs(Isnull(A.QTY, 0) - Isnull(B.QTY, 0))         AS ABS_QTY,
               'OIL Stock'                                      AS CATEGORY,
               1                                                AS ORDERBY,
               'OIL'                                                AS TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,

                       ALLOCATION_TYPE,
                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
                FROM   DAILY_PNL_ATTRIBUTION
                WHERE  ALLOCATION_TYPE = 'STOCK'
                       AND LONG_SHORT = 'LONG'
                       AND INSTRUMENT_TYPE = 'PHYSICAL'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND 0=0
                AND $X{IN,COMMODITY,cmd}

        AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          ALLOCATION_TYPE,
                          EOD_DATE) A
               FULL JOIN (SELECT PROFIT_CENTER,
                                 ALLOCATION_TYPE,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
                          FROM   DAILY_PNL_ATTRIBUTION
                          WHERE  ALLOCATION_TYPE = 'STOCK'
                                 AND LONG_SHORT = 'SHORT'
                                 AND INSTRUMENT_TYPE = 'PHYSICAL'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND 0=0
                          AND $X{IN,COMMODITY,cmd}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    ALLOCATION_TYPE,
                                    EOD_DATE) B
                      ON A.PROFIT_CENTER = B.PROFIT_CENTER

                         AND A.ALLOCATION_TYPE = B.ALLOCATION_TYPE
                         AND A.ATTRIBUTION_DATE = B.ATTRIBUTION_DATE
       WHERE  COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) <= $P{date_to}
           AND Isnull(A.QTY,0) - Isnull(B.QTY,0) <> 0
           AND $X{IN,CASE WHEN A.PROFIT_CENTER IS NOT NULL THEN A.PROFIT_CENTER ELSE B.PROFIT_CENTER END,pc}
       )STOCK
WHERE  QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
          CATEGORY,
          ORDERBY,
          TYPE_OF_DATA
UNION
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)      AS QTY,
       Sum(Abs(A.QTY)) AS ABS_QTY,
       'All Purchases' AS CATEGORY,
       2               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
	--Fixed Price Purchases
	SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)              AS QTY,
       --Sum(Abs(A.QTY))         AS ABS_QTY,
      -- 'Fixed Price Purchases' AS CATEGORY,
      --5                       AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'LONG'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,
                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY ,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
       WHERE  ORIGIN_DATA_TYPE IN ( 'PO')--,'IV' )
			   AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--Unpriced Purchases
	SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)           AS QTY,
       --Sum(Abs(A.QTY))      AS ABS_QTY,
       --'Unpriced Purchases' AS CATEGORY,
       --11                    AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'LONG'
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
			   AND ALLOCATION_ID = PRICING_ID
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}

         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE IN ( 'PO')--,'IV' )
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,MATERIAL_GROUP,cmd}

        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--DIff Purchases pending fixation
	SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + PROFIT_CENTER,
		   PROFIT_CENTER,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin' AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'PO')--,'IV' )
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,MATERIAL_GROUP,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY
          PROFIT_CENTER,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL' AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'LONG'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	$P!{QSTR_Filter}
	GROUP  BY  PROFIT_CENTER,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
          --POSITION_TYPE,
          --ORDERBY,
		  --GROUPBY
				  ) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)     AS QTY,
       Sum(Abs(A.QTY)) AS ABS_QTY,
       'All Sales'     AS CATEGORY,
       3               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
--Fixed Priced Sales
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)         AS QTY,
       --Sum(Abs(A.QTY))     AS ABS_QTY,
       --'Fixed Price Sales' AS CATEGORY,
      -- 6                   AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'SHORT'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,
                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Unpriced Sales
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)      AS QTY,
       --Sum(Abs(A.QTY))  AS ABS_QTY,
       --'Unpriced Sales' AS CATEGORY,
       --12                AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'SHORT'
               AND ALLOCATION_ID = PRICING_ID
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
			    AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
				AND 0=0
			 AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Diff Sales Pending Fixation
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + PROFIT_CENTER,
		   PROFIT_CENTER,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin' AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'SO')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,MATERIAL_GROUP,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY
          PROFIT_CENTER,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL' AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'SHORT'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	$P!{QSTR_Filter}
	GROUP  BY  PROFIT_CENTER,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA

) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT PROFIT_CENTER,

       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(Abs(QTY)) AS ABS_QTY,
       '   Net Physicals' AS CATEGORY,
       4 AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,

       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       --Sum(ABS_QTY) AS ABS_QTY
       --CATEGORY,
       --ORDERBY,
       TYPE_OF_DATA
		FROM   (SELECT A.PROFIT_CENTER,
               A.ATTRIBUTION_DATE,
               A.QTY,
               --Abs(A.QTY)     AS ABS_QTY
               --'Origin Stock' AS CATEGORY,
               --0              AS ORDERBY,
               TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,
                       REPORT_DATE    AS ATTRIBUTION_DATE,
                       Sum(QUANTITY)  AS QTY,
					   'Origin' AS TYPE_OF_DATA
                FROM   DM_POSITION_DATA
                WHERE  ORIGIN_DATA_TYPE = 'IV'
				AND	   0=0
                AND $X{IN,MATERIAL_GROUP,cmd}

        AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          REPORT_DATE) A
        WHERE  ATTRIBUTION_DATE >= $P{date_from}
               AND ATTRIBUTION_DATE <= $P{date_to}
             AND $X{IN,PROFIT_CENTER,pc}

         AND A.QTY <> 0
		 UNION
		 SELECT COALESCE(A.PROFIT_CENTER, B.PROFIT_CENTER)               AS PROFIT_CENTER,

               COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               Isnull(A.QTY, 0) - Isnull(B.QTY, 0)              AS QTY,
			   --Abs(Isnull(A.QTY, 0) - Isnull(B.QTY, 0))         AS ABS_QTY
              -- 'OIL Stock'                                      AS CATEGORY,
               --1                                                AS ORDERBY,
               'OIL' AS TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,

                       ALLOCATION_TYPE,
                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
				FROM   DAILY_PNL_ATTRIBUTION
                WHERE  ALLOCATION_TYPE = 'STOCK'
                       AND LONG_SHORT = 'LONG'
                       AND INSTRUMENT_TYPE = 'PHYSICAL'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND 0=0
                AND $X{IN,COMMODITY,cmd}

        AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          ALLOCATION_TYPE,
                          EOD_DATE) A
               FULL JOIN (SELECT PROFIT_CENTER,
                                 ALLOCATION_TYPE,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
                          FROM   DAILY_PNL_ATTRIBUTION
                          WHERE  ALLOCATION_TYPE = 'STOCK'
                                 AND LONG_SHORT = 'SHORT'
                                 AND INSTRUMENT_TYPE = 'PHYSICAL'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND 0=0
                          AND $X{IN,COMMODITY,cmd}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    ALLOCATION_TYPE,
                                    EOD_DATE) B
                      ON A.PROFIT_CENTER = B.PROFIT_CENTER

                         AND A.ALLOCATION_TYPE = B.ALLOCATION_TYPE
                         AND A.ATTRIBUTION_DATE = B.ATTRIBUTION_DATE
       WHERE  COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) <= $P{date_to}
           AND Isnull(A.QTY,0) - Isnull(B.QTY,0) <> 0
           AND $X{IN,CASE WHEN A.PROFIT_CENTER IS NOT NULL THEN A.PROFIT_CENTER ELSE B.PROFIT_CENTER END,pc}
        )STOCK
		WHERE  QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
          --CATEGORY,
          --ORDERBY,
         -- GROUPBY
UNION ALL
--All Purchases
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)      AS QTY,
       --Sum(Abs(A.QTY)) AS ABS_QTY,
       --'All Purchases' AS CATEGORY,
       --2               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
	--Fixed Price Purchases
	SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)              AS QTY,
       --Sum(Abs(A.QTY))         AS ABS_QTY,
      -- 'Fixed Price Purchases' AS CATEGORY,
      --5                       AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'LONG'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,
                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
       WHERE  ORIGIN_DATA_TYPE IN ( 'PO')--,'IV' )
			   AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--Unpriced Purchases
	SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)           AS QTY,
       --Sum(Abs(A.QTY))      AS ABS_QTY,
       --'Unpriced Purchases' AS CATEGORY,
       --11                    AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'LONG'
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
			   AND ALLOCATION_ID = PRICING_ID
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}

         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE IN ( 'PO' )
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,MATERIAL_GROUP,cmd}

        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--DIff Purchases pending fixation
	SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + PROFIT_CENTER,
		   PROFIT_CENTER,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin' AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'PO')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,MATERIAL_GROUP,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY
          PROFIT_CENTER,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		   'OIL' AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'LONG'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	$P!{QSTR_Filter}
	GROUP  BY  PROFIT_CENTER,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
          --POSITION_TYPE,
          --ORDERBY,
		  --GROUPBY
				  ) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--ALL Sales
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)     AS QTY,
       --Sum(Abs(A.QTY)) AS ABS_QTY,
       --'All Sales'     AS CATEGORY,
       --3               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
--Fixed Priced Sales
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)         AS QTY,
       --Sum(Abs(A.QTY))     AS ABS_QTY,
       --'Fixed Price Sales' AS CATEGORY,
      -- 6                   AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'SHORT'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,
                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			    'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Unpriced Sales
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)      AS QTY,
       --Sum(Abs(A.QTY))  AS ABS_QTY,
       --'Unpriced Sales' AS CATEGORY,
       --12                AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			    'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'SHORT'
               AND ALLOCATION_ID = PRICING_ID
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
			    AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
				AND 0=0
			 AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			    'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
		  ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Diff Sales Pending Fixation
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + PROFIT_CENTER,
		   PROFIT_CENTER,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin' AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'SO')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,MATERIAL_GROUP,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY
          PROFIT_CENTER,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		   'OIL' AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'SHORT'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	$P!{QSTR_Filter}
	GROUP  BY  PROFIT_CENTER,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA

) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
       )NET_PHYSICAL
WHERE  QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
          --CATEGORY,
          --ORDERBY,
          --GROUPBY
UNION
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)              AS QTY,
       Sum(Abs(A.QTY))         AS ABS_QTY,
       'Fixed Price Purchases' AS CATEGORY,
       5                       AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'LONG'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   --AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,
                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
       WHERE  ORIGIN_DATA_TYPE IN ( 'PO','IV' )
			   AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)         AS QTY,
       Sum(Abs(A.QTY))     AS ABS_QTY,
       'Fixed Price Sales' AS CATEGORY,
       6                   AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'SHORT'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   --AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,
                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		 TYPE_OF_DATA
UNION
SELECT PROFIT_CENTER,

       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(ABS_QTY) AS ABS_QTY,
       CATEGORY,
       ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.PROFIT_CENTER, PSALES.PROFIT_CENTER, ORIGIN_PURCH.PROFIT_CENTER, ORIGIN_SALES.PROFIT_CENTER)                             AS PROFIT_CENTER,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Fixed Price Position'                                                                                           AS CATEGORY,
               7                                                                                                                       AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,

                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
				FROM   DAILY_PNL_ATTRIBUTION A
				LEFT JOIN DAILY_CONTRACT_DATA CTR
					ON A.POSITION_ID = CTR.POSITION_ID
                WHERE  ( PRICING_TYPE = 'PRICED'
                          OR ( PRICING_TYPE = 'UNPRICED'
                               AND ALLOCATION_ID <> PRICING_ID ) )
                       AND LONG_SHORT = 'LONG'
                       AND A.INSTRUMENT_TYPE = 'PHYSICAL'
					   --AND ALLOCATION_TYPE <> 'STOCK'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND CTR_TYPE <> 'PAPER'
					   AND 0=0
                     AND $X{IN,COMMODITY,cmd}

             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          EOD_DATE) PRICE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'OIL' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION A
							LEFT JOIN DAILY_CONTRACT_DATA CTR
								ON A.POSITION_ID = CTR.POSITION_ID
                          WHERE  ( PRICING_TYPE = 'PRICED'
                                    OR ( PRICING_TYPE = 'UNPRICED'
                                         AND ALLOCATION_ID <> PRICING_ID ) )
                                 AND LONG_SHORT = 'SHORT'
                                 AND A.INSTRUMENT_TYPE = 'PHYSICAL'
								 --AND ALLOCATION_TYPE <> 'STOCK'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND CTR_TYPE <> 'PAPER'
								 AND 0=0
                                   AND $X{IN,COMMODITY,cmd}
                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,
                                    EOD_DATE) PSALES
                      ON PSALES.PROFIT_CENTER = PRICE.PROFIT_CENTER
                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  --ORIGIN_DATA_TYPE IN ( 'PO' )
						  ORIGIN_DATA_TYPE IN ( 'PO', 'IV' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,MATERIAL_GROUP,cmd}
						  AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,
                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,MATERIAL_GROUP,cmd}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.PROFIT_CENTER IS NOT NULL THEN PRICE.PROFIT_CENTER
         WHEN PSALES.PROFIT_CENTER IS NOT NULL THEN PSALES.PROFIT_CENTER
         WHEN ORIGIN_PURCH.PROFIT_CENTER IS NOT NULL THEN ORIGIN_PURCH.PROFIT_CENTER
         WHEN ORIGIN_SALES.PROFIT_CENTER IS NOT NULL THEN ORIGIN_SALES.PROFIT_CENTER
       END,pc}
       )FIXED_PRICE
WHERE  QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
          CATEGORY,
          ORDERBY,
          TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + PROFIT_CENTER,
		   PROFIT_CENTER,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		   'Origin' AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,MATERIAL_GROUP,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY
          PROFIT_CENTER,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL' AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   --AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	$P!{QSTR_Filter}
	GROUP  BY  PROFIT_CENTER,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
          POSITION_TYPE,
          ORDERBY,
		 TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		Abs(sum(Isnull(QTY, 0)))				 AS ABS_QTY,
		POSITION								 AS CATEGORY,
        ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA

FROM
(
		SELECT Sum(QTY)                                AS QTY,
			   CTR.CONTRACT_BOOK AS CONTRACT_BOOK,
			   --CTR.CONTRACT_BOOK + ' ' + CTR.PROFIT_CENTER AS PROFIT_CENTER,
			   CTR.PROFIT_CENTER AS PROFIT_CENTER,

			   NULL                                    AS POSITION_TYPE,
			   1                                       AS FLAG,
			   10                                      AS ORDERBY,
			   TYPE_OF_DATA,
			   --'Net Differential Price Position'       AS POSITION,
			   '   Net Diff Position'       AS POSITION,
			   ATTRIBUTION_DATE
		FROM   (SELECT Sum(CASE
							 --WHEN LONG_SHORT = 'Long' THEN QUANTITY
							 --ELSE -QUANTITY
							 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN QUANTITY
							 ELSE -QUANTITY
						   END)       AS QTY,
						   'Origin' AS TYPE_OF_DATA,
					   CONTRACT_BOOK,
					   PROFIT_CENTER,

					   A.REPORT_DATE						AS ATTRIBUTION_DATE
				FROM   DM_POSITION_DATA A
				WHERE  --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
					   A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
					   AND	   0=0
					   AND PRICED_UNPRICED = 'Unpriced'
				AND $X{IN,CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,MATERIAL_GROUP,cmd}

				$P!{QSTR_Filter}
				GROUP  BY PROFIT_CENTER,

						  CONTRACT_BOOK,
						  A.REPORT_DATE
				UNION
				SELECT Sum(CASE
							 WHEN LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						   END) AS QTY,
						   'OIL' AS TYPE_OF_DATA,
					   A.CONTRACT_BOOK,
					   A.PROFIT_CENTER,

					   A.EOD_DATE						AS ATTRIBUTION_DATE
				FROM   DAILY_PNL_ATTRIBUTION A
					   LEFT JOIN DAILY_CONTRACT_DATA CTR
							  ON A.POSITION_ID = CTR.POSITION_ID
				WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
					   AND A.ALLOCATION_TYPE IS NOT NULL
					   --AND A.ALLOCATION_TYPE <> 'STOCK'
					   AND PRICING_TYPE = 'UNPRICED'
					   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
					   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
					   AND ALLOCATION_ID = PRICING_ID
					   AND 0=0
				AND $X{IN,A.CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,COMMODITY,cmd}

				$P!{QSTR_Filter}
				GROUP  BY PROFIT_CENTER,

						  CONTRACT_BOOK,
						  A.EOD_DATE
				)CTR
GROUP  BY CTR.PROFIT_CENTER,
          CTR.ATTRIBUTION_DATE,
		  CTR.CONTRACT_BOOK,
		  CTR.TYPE_OF_DATA
) NDPP
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
          POSITION,
          ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)           AS QTY,
       Sum(Abs(A.QTY))      AS ABS_QTY,
       'Unpriced Purchases' AS CATEGORY,
       11                    AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'LONG'
               AND INSTRUMENT_TYPE = 'PHYSICAL'
               AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
			   AND ALLOCATION_ID = PRICING_ID
			   AND 0=0
             AND $X{IN,COMMODITY,cmd}

         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE IN ( 'IV', 'PO' )
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,MATERIAL_GROUP,cmd}

        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		 TYPE_OF_DATA
UNION
SELECT A.PROFIT_CENTER,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)      AS QTY,
       Sum(Abs(A.QTY))  AS ABS_QTY,
       'Unpriced Sales' AS CATEGORY,
       12                AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT PROFIT_CENTER,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'SHORT'
               AND ALLOCATION_ID = PRICING_ID
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			    AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
				AND 0=0
			 AND $X{IN,COMMODITY,cmd}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  EOD_DATE
        UNION
        SELECT PROFIT_CENTER,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,MATERIAL_GROUP,cmd}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY PROFIT_CENTER,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,PROFIT_CENTER,pc}
     AND A.QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT PROFIT_CENTER,

       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(ABS_QTY) AS ABS_QTY,
       CATEGORY,
       ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.PROFIT_CENTER, PSALES.PROFIT_CENTER, ORIGIN_PURCH.PROFIT_CENTER, ORIGIN_SALES.PROFIT_CENTER)                             AS PROFIT_CENTER,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Unpriced Position'                                                                                              AS CATEGORY,
               13                                                                                                                      AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,

                       PRICING_TYPE,
                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
                FROM   DAILY_PNL_ATTRIBUTION
                WHERE  PRICING_TYPE = 'UNPRICED'
                       AND LONG_SHORT = 'LONG'
                       AND ALLOCATION_ID = PRICING_ID
                       AND INSTRUMENT_TYPE = 'PHYSICAL'
                       --AND CURRENT_OPEN_QUANTITY > 0
					   AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                        OR BASIS_MARKET_PRICE_INDEX = 'NA' )

					   AND 0=0
                     AND $X{IN,COMMODITY,cmd}

             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          PRICING_TYPE,
                          EOD_DATE) PRICE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 PRICING_TYPE,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'OIL' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION
					      WHERE  PRICING_TYPE = 'UNPRICED'
                                 AND LONG_SHORT = 'SHORT'
                                 AND ALLOCATION_ID = PRICING_ID
                                 AND INSTRUMENT_TYPE = 'PHYSICAL'
                                 --AND CURRENT_OPEN_QUANTITY > 0
								AND ( BASIS_MARKET_PRICE_INDEX IS NULL
									OR BASIS_MARKET_PRICE_INDEX = 'NA' )

								 AND 0=0
                                   AND $X{IN,COMMODITY,cmd}

                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    PRICING_TYPE,
                                    EOD_DATE) PSALES
                      ON PSALES.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE IN ( 'IV', 'PO' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Unpriced'
                          AND $X{IN,MATERIAL_GROUP,cmd}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Unpriced'
                          AND $X{IN,MATERIAL_GROUP,cmd}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.PROFIT_CENTER IS NOT NULL THEN PRICE.PROFIT_CENTER
         WHEN PSALES.PROFIT_CENTER IS NOT NULL THEN PSALES.PROFIT_CENTER
         WHEN ORIGIN_PURCH.PROFIT_CENTER IS NOT NULL THEN ORIGIN_PURCH.PROFIT_CENTER
         WHEN ORIGIN_SALES.PROFIT_CENTER IS NOT NULL THEN ORIGIN_SALES.PROFIT_CENTER
       END,pc}
       )NET_UNPRICED_POSITION
WHERE  QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
          CATEGORY,
          ORDERBY,
          TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		Sum(Isnull(QTY, 0))      AS QTY,
		Sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        ORDERBY                                  AS ORDERBY,
        TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
			   'OIL' AS TYPE_OF_DATA,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   'Futures'                           AS POSITION_TYPE,
		   0                                   AS FLAG,
		   14                                  AS ORDERBY,
		   'Net Derivatives Position'          AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	AND 0=0
	$P!{QSTR_Filter}
	GROUP  BY A.PROFIT_CENTER,
			  A.CONTRACT_BOOK,
			  A.EOD_DATE
) FUTURES
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  POSITION_TYPE,
		  ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        ORDERBY                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 --WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
			   'OIL' AS TYPE_OF_DATA,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   'Listed Options Delta'              AS POSITION_TYPE,
		   0                                   AS FLAG,
		   15                                  AS ORDERBY,
		   'Net Derivatives Position'          AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
	AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	$P!{QSTR_Filter}
	GROUP  BY A.PROFIT_CENTER,
			  A.CONTRACT_BOOK,
			  A.EOD_DATE
	) LISTED_OPTIONS_DELTA
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  POSITION_TYPE,
		  ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        16                                      AS ORDERBY,
        TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
			   'OIL' AS TYPE_OF_DATA,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.PROFIT_CENTER AS PROFIT_CENTER,
		   A.PROFIT_CENTER AS PROFIT_CENTER,

		   'Paper Trades'                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   16                                  AS ORDERBY,
		   'Net Derivatives Position'          AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   --AND LONG_SHORT = 'LONG'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND CTR_TYPE = 'PAPER'
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,COMMODITY,cmd}

	$P!{QSTR_Filter}
GROUP  BY A.PROFIT_CENTER,
		A.CONTRACT_BOOK,
		A.EOD_DATE
	) PAPER_TRADES
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  POSITION_TYPE,
		  ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        17                                       AS ORDERBY,
        NDP.TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.PROFIT_CENTER AS PROFIT_CENTER,
	   CTR.PROFIT_CENTER AS PROFIT_CENTER,

       NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       17                                      AS ORDERBY,
       '   Net Derivatives Position'              AS POSITION,
	   CTR.EOD_DATE							   AS ATTRIBUTION_DATE,
	   'OIL' AS TYPE_OF_DATA
FROM   (SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
               A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

			   A.EOD_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
		AND 0=0
        AND $X{IN,CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

				  A.CONTRACT_BOOK,
                  A.EOD_DATE
        UNION
        SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
               A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

			   A.EOD_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
		AND 0=0
        AND $X{IN,CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

				  A.CONTRACT_BOOK,
                  A.EOD_DATE
        UNION
        SELECT --Sum(( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )) AS QTY,
			   Sum(CASE
					 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
					 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
               A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

			   A.EOD_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
               --AND LONG_SHORT = 'LONG'
               AND A.ALLOCATION_TYPE <> 'STOCK'
               AND CTR_TYPE = 'PAPER'
			   AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
		GROUP  BY A.PROFIT_CENTER,
		A.CONTRACT_BOOK,
		A.EOD_DATE
		) CTR
GROUP  BY PROFIT_CENTER,

		  CONTRACT_BOOK,
		  EOD_DATE
	) NDP
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        18                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       --CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.PROFIT_CENTER AS PROFIT_CENTER,
	   CTR.PROFIT_CENTER AS PROFIT_CENTER,

	   CTR.ATTRIBUTION_DATE						AS ATTRIBUTION_DATE,
		NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       18                                      AS ORDERBY,
       '   Outright Position'                     AS POSITION,
	   TYPE_OF_DATA
FROM   (SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
			   --A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

			   A.EOD_DATE AS ATTRIBUTION_DATE,
			    'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
			   --A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

			   A.EOD_DATE AS ATTRIBUTION_DATE,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT --Sum(( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )) AS QTY,
				SUM(CASE
							WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						END)                            AS QTY,
			   --A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

               A.EOD_DATE AS ATTRIBUTION_DATE,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		AND 0=0
               --AND LONG_SHORT = 'LONG'
               AND A.ALLOCATION_TYPE <> 'STOCK'
               AND CTR_TYPE = 'PAPER'
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT
		Sum(QTY)     AS QTY,
		PROFIT_CENTER,

       ATTRIBUTION_DATE,

       --Sum(ABS_QTY) AS ABS_QTY,
       --CATEGORY,
       --ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.PROFIT_CENTER, PSALES.PROFIT_CENTER, ORIGIN_PURCH.PROFIT_CENTER, ORIGIN_SALES.PROFIT_CENTER)                             AS PROFIT_CENTER,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Fixed Price Position'                                                                                           AS CATEGORY,
               7                                                                                                                       AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,

                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
                FROM   DAILY_PNL_ATTRIBUTION A
				LEFT JOIN DAILY_CONTRACT_DATA CTR
					ON A.POSITION_ID = CTR.POSITION_ID
                WHERE  ( PRICING_TYPE = 'PRICED'
                          OR ( PRICING_TYPE = 'UNPRICED'
                               AND ALLOCATION_ID <> PRICING_ID ) )
                       AND LONG_SHORT = 'LONG'
                       AND A.INSTRUMENT_TYPE = 'PHYSICAL'
					   --AND ALLOCATION_TYPE <> 'STOCK'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND CTR_TYPE <> 'PAPER'
					   AND 0=0
                     AND $X{IN,COMMODITY,cmd}

             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          EOD_DATE) PRICE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'OIL' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION A
							LEFT JOIN DAILY_CONTRACT_DATA CTR
								ON A.POSITION_ID = CTR.POSITION_ID
                          WHERE  ( PRICING_TYPE = 'PRICED'
                                    OR ( PRICING_TYPE = 'UNPRICED'
                                         AND ALLOCATION_ID <> PRICING_ID ) )
                                 AND LONG_SHORT = 'SHORT'
                                 AND A.INSTRUMENT_TYPE = 'PHYSICAL'
								 --AND ALLOCATION_TYPE <> 'STOCK'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND CTR_TYPE <> 'PAPER'
								 AND 0=0
                                   AND $X{IN,COMMODITY,cmd}
                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,
                                    EOD_DATE) PSALES
                      ON PSALES.PROFIT_CENTER = PRICE.PROFIT_CENTER
                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  --ORIGIN_DATA_TYPE IN ( 'PO' )
						  ORIGIN_DATA_TYPE IN ( 'PO', 'IV' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,MATERIAL_GROUP,cmd}
						  AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,
                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,MATERIAL_GROUP,cmd}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.PROFIT_CENTER IS NOT NULL THEN PRICE.PROFIT_CENTER
         WHEN PSALES.PROFIT_CENTER IS NOT NULL THEN PSALES.PROFIT_CENTER
         WHEN ORIGIN_PURCH.PROFIT_CENTER IS NOT NULL THEN ORIGIN_PURCH.PROFIT_CENTER
         WHEN ORIGIN_SALES.PROFIT_CENTER IS NOT NULL THEN ORIGIN_SALES.PROFIT_CENTER
       END,pc}
       )FIXED_PRICE
WHERE  QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
         -- CATEGORY,
         -- ORDERBY,
         TYPE_OF_DATA
        ) CTR
GROUP  BY CTR.PROFIT_CENTER,
         -- CTR.CONTRACT_BOOK,
		  CTR.ATTRIBUTION_DATE,
		  CTR.TYPE_OF_DATA
		  ) OUTRIGHT
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		CAST(ATTRIBUTION_DATE AS DATE) ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        19                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       --CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.PROFIT_CENTER AS PROFIT_CENTER,
	   CTR.PROFIT_CENTER AS PROFIT_CENTER,

	   CTR.ATTRIBUTION_DATE						AS ATTRIBUTION_DATE,
       NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       19                                      AS ORDERBY,
       '   Basis Position'						   AS POSITION,
	   TYPE_OF_DATA
FROM   (
		--Net Fixed Price calulation
SELECT
		Sum(QTY)     AS QTY,
		PROFIT_CENTER,

       ATTRIBUTION_DATE,

       --Sum(ABS_QTY) AS ABS_QTY,
       --CATEGORY,
       --ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.PROFIT_CENTER, PSALES.PROFIT_CENTER, ORIGIN_PURCH.PROFIT_CENTER, ORIGIN_SALES.PROFIT_CENTER)                             AS PROFIT_CENTER,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Fixed Price Position'                                                                                           AS CATEGORY,
               7                                                                                                                       AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT PROFIT_CENTER,

                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
                FROM   DAILY_PNL_ATTRIBUTION A
				LEFT JOIN DAILY_CONTRACT_DATA CTR
					ON A.POSITION_ID = CTR.POSITION_ID
                WHERE  ( PRICING_TYPE = 'PRICED'
                          OR ( PRICING_TYPE = 'UNPRICED'
                               AND ALLOCATION_ID <> PRICING_ID ) )
                       AND LONG_SHORT = 'LONG'
                       AND A.INSTRUMENT_TYPE = 'PHYSICAL'
					   --AND ALLOCATION_TYPE <> 'STOCK'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND CTR_TYPE <> 'PAPER'
					   AND 0=0
                     AND $X{IN,COMMODITY,cmd}

             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY PROFIT_CENTER,

                          EOD_DATE) PRICE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION A
							LEFT JOIN DAILY_CONTRACT_DATA CTR
								ON A.POSITION_ID = CTR.POSITION_ID
                          WHERE  ( PRICING_TYPE = 'PRICED'
                                    OR ( PRICING_TYPE = 'UNPRICED'
                                         AND ALLOCATION_ID <> PRICING_ID ) )
                                 AND LONG_SHORT = 'SHORT'
                                 AND A.INSTRUMENT_TYPE = 'PHYSICAL'
								 --AND ALLOCATION_TYPE <> 'STOCK'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND CTR_TYPE <> 'PAPER'
								 AND 0=0
                                   AND $X{IN,COMMODITY,cmd}
                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,
                                    EOD_DATE) PSALES
                      ON PSALES.PROFIT_CENTER = PRICE.PROFIT_CENTER
                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  --ORIGIN_DATA_TYPE IN ( 'PO' )
						  ORIGIN_DATA_TYPE IN ( 'PO', 'IV' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,MATERIAL_GROUP,cmd}
						  AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,
                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT PROFIT_CENTER,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,MATERIAL_GROUP,cmd}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY PROFIT_CENTER,

                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.PROFIT_CENTER = PRICE.PROFIT_CENTER

                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.PROFIT_CENTER IS NOT NULL THEN PRICE.PROFIT_CENTER
         WHEN PSALES.PROFIT_CENTER IS NOT NULL THEN PSALES.PROFIT_CENTER
         WHEN ORIGIN_PURCH.PROFIT_CENTER IS NOT NULL THEN ORIGIN_PURCH.PROFIT_CENTER
         WHEN ORIGIN_SALES.PROFIT_CENTER IS NOT NULL THEN ORIGIN_SALES.PROFIT_CENTER
       END,pc}
       )FIXED_PRICE
WHERE  QTY <> 0
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
         -- CATEGORY,
         -- ORDERBY,
         TYPE_OF_DATA
		 UNION ALL
        ----Net Diff calulation
        SELECT Sum(CASE
							 --WHEN LONG_SHORT = 'Long' THEN QUANTITY
							 --ELSE -QUANTITY
							 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN QUANTITY
							 ELSE -QUANTITY
						   END)       AS QTY,
					   --CONTRACT_BOOK,
					   PROFIT_CENTER,

					   A.REPORT_DATE			AS ATTRIBUTION_DATE,
					   'Origin' AS TYPE_OF_DATA
				FROM   DM_POSITION_DATA A
				WHERE  --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
					   A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
					   AND	   0=0
					   AND PRICED_UNPRICED = 'Unpriced'
				AND $X{IN,CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,MATERIAL_GROUP,cmd}

				$P!{QSTR_Filter}
				GROUP  BY PROFIT_CENTER,

						  --CONTRACT_BOOK,
						  A.REPORT_DATE
				UNION ALL
				SELECT Sum(CASE
							 WHEN LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						   END) AS QTY,
					   --A.CONTRACT_BOOK,
					   A.PROFIT_CENTER,

					   A.EOD_DATE				AS ATTRIBUTION_DATE,
					   'OIL' AS TYPE_OF_DATA
				FROM   DAILY_PNL_ATTRIBUTION A
					   LEFT JOIN DAILY_CONTRACT_DATA CTR
							  ON A.POSITION_ID = CTR.POSITION_ID
				WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
					   AND A.ALLOCATION_TYPE IS NOT NULL
					   --AND A.ALLOCATION_TYPE <> 'STOCK'
					   AND PRICING_TYPE = 'UNPRICED'
					   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
					   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
					   AND ALLOCATION_ID = PRICING_ID
					   AND 0=0
				AND $X{IN,A.CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,COMMODITY,cmd}

				$P!{QSTR_Filter}
				GROUP  BY PROFIT_CENTER,

						  --CONTRACT_BOOK,
						  A.EOD_DATE
				  )CTR
GROUP  BY CTR.PROFIT_CENTER,
          --CTR.CONTRACT_BOOK,
		  CTR.ATTRIBUTION_DATE,
		  CTR.TYPE_OF_DATA
		  ) BASIS
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
UNION
SELECT  PROFIT_CENTER,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        20                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       --CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.PROFIT_CENTER AS PROFIT_CENTER,
	   CTR.PROFIT_CENTER AS PROFIT_CENTER,

	   CTR.ATTRIBUTION_DATE						AS ATTRIBUTION_DATE,
       NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       20                                      AS ORDERBY,
       '   Structure Position'                    AS POSITION,
	   TYPE_OF_DATA
FROM   (SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
				   'OIL' AS TYPE_OF_DATA,
               --A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

			   A.EOD_DATE AS ATTRIBUTION_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
				   'OIL' AS TYPE_OF_DATA,
               --A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

			   A.EOD_DATE AS ATTRIBUTION_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT --Sum(( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )) AS QTY,
				SUM(CASE
							WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						END)                            AS QTY,
						'OIL' AS TYPE_OF_DATA,
               --A.CONTRACT_BOOK,
               A.PROFIT_CENTER,

               A.EOD_DATE AS ATTRIBUTION_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		AND 0=0
               --AND LONG_SHORT = 'LONG'
               AND A.ALLOCATION_TYPE <> 'STOCK'
               AND CTR_TYPE = 'PAPER'
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.PROFIT_CENTER,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION ALL
        SELECT Sum(CASE
							 --WHEN LONG_SHORT = 'Long' THEN QUANTITY
							 --ELSE -QUANTITY
							 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN -QUANTITY
							 ELSE QUANTITY
						   END)       AS QTY,
						   'Origin' AS TYPE_OF_DATA,
					   --CONTRACT_BOOK,
					   PROFIT_CENTER,

					   A.REPORT_DATE						AS ATTRIBUTION_DATE
				FROM   DM_POSITION_DATA A
				WHERE  --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
					   A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
					   AND	   0=0
					   AND PRICED_UNPRICED = 'Unpriced'
				AND $X{IN,CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,MATERIAL_GROUP,cmd}

				$P!{QSTR_Filter}
				GROUP  BY PROFIT_CENTER,

						  --CONTRACT_BOOK,
						  A.REPORT_DATE
				UNION ALL
				SELECT Sum(CASE
							 WHEN LONG_SHORT = 'LONG' THEN -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							 ELSE ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						   END) AS QTY,
						   'OIL' AS TYPE_OF_DATA,
					   --A.CONTRACT_BOOK,
					   A.PROFIT_CENTER,

					   A.EOD_DATE						AS ATTRIBUTION_DATE
				FROM   DAILY_PNL_ATTRIBUTION A
					   LEFT JOIN DAILY_CONTRACT_DATA CTR
							  ON A.POSITION_ID = CTR.POSITION_ID
				WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
					   AND A.ALLOCATION_TYPE IS NOT NULL
					   --AND A.ALLOCATION_TYPE <> 'STOCK'
					   AND PRICING_TYPE = 'UNPRICED'
					   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
					   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
					   AND ALLOCATION_ID = PRICING_ID
					   AND 0=0
				AND $X{IN,A.CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,COMMODITY,cmd}

				$P!{QSTR_Filter}
				GROUP  BY PROFIT_CENTER,

						  --CONTRACT_BOOK,
						  A.EOD_DATE) CTR
GROUP  BY CTR.PROFIT_CENTER,
          --CTR.CONTRACT_BOOK,
		    --CTR.SHIP_MONTH,
          --CTR.MONTHNUMBER,
		  CTR.ATTRIBUTION_DATE,
		  CTR.TYPE_OF_DATA
		  ) STRUCTURE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY PROFIT_CENTER,

          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
		  )T1
ON (T1.ATTRIBUTION_DATE = T2.asofdate AND T1.TYPE_OF_DATA = 'OIL' AND T1.PROFIT_CENTER = T2.PROFIT_CENTER)
	OR
   (T1.ATTRIBUTION_DATE = T2.origindate AND T1.TYPE_OF_DATA = 'Origin' AND T1.PROFIT_CENTER = T2.PROFIT_CENTER)
WHERE T2.PROFIT_CENTER IS NOT NULL
GROUP  BY   T2.PROFIT_CENTER,
			--T1.ATTRIBUTION_DATE,
			T2.asofdate,
			--T2.origindate,
			--T1.ATTRIBUTION_DATE,
			CATEGORY,
			--TYPE_OF_DATA,
			 T1.QTY,
		    T1.ABS_QTY,
			ORDERBY]]>
		</queryString>
		<field name="PROFIT_CENTER" class="java.lang.String"/>
		<field name="ATTRIBUTION_DATE" class="java.sql.Date"/>
		<field name="QTY" class="java.math.BigDecimal"/>
		<field name="ABS_QTY" class="java.math.BigDecimal"/>
		<field name="CATEGORY" class="java.lang.String"/>
		<field name="ORDERBY" class="java.lang.Integer"/>
		<variable name="AVG_QTY1" class="java.math.BigDecimal" calculation="Sum">
			<variableExpression><![CDATA[$F{QTY}]]></variableExpression>
		</variable>
		<group name="PROFIT_CENTER">
			<groupExpression><![CDATA[$F{PROFIT_CENTER}]]></groupExpression>
		</group>
		<group name="GROUPBY"/>
	</subDataset>
	<subDataset name="product" uuid="2c136c46-2fd3-402d-9e65-90328efe0bfc">
		<property name="com.jaspersoft.studio.data.defaultdataadapter" value="QA"/>
		<parameter name="date_from" class="java.util.Date"/>
		<parameter name="date_to" class="java.util.Date"/>
		<parameter name="pc" class="java.util.Collection"/>
		<parameter name="cmd" class="java.util.Collection"/>
		<parameter name="cbk" class="java.util.Collection"/>
		<parameter name="LE_Filter" class="java.lang.String">
			<parameterDescription><![CDATA[]]></parameterDescription>
			<defaultValueExpression><![CDATA[$P{LE_Filter}]]></defaultValueExpression>
		</parameter>
		<parameter name="QSTR_Filter" class="java.lang.String" isForPrompting="false">
			<defaultValueExpression><![CDATA[" AND CONTRACT_BOOK IN ('" + $P{LE_Filter} + "')"]]></defaultValueExpression>
		</parameter>
		<parameter name="asofdate" class="java.util.Date">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<parameter name="origindate" class="java.util.Date">
			<defaultValueExpression><![CDATA[]]></defaultValueExpression>
		</parameter>
		<queryString>
			<![CDATA[SELECT  --ISNULL(T1.COMMODITY,T2.COMMODITY) AS COMMODITY,
		T2.COMMODITY AS COMMODITY,
	   --COALESCE(T2.asofdate,T2.origindate,T1.ATTRIBUTION_DATE) AS
	   T2.asofdate AS ATTRIBUTION_DATE,
       QTY,
       ABS_QTY,
       CATEGORY,
	   --T1.TYPE_OF_DATA,
       ORDERBY
FROM  (SELECT  distinct eod.CONTRACT_BOOK CONTRACT_BOOK,
						PROFIT_CENTER,
						COMMODITY,
						eod.EOD_DATE  asofdate,
						(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
							FROM DM_POSITION_DATA DPD
							WHERE DPD.CONTRACT_BOOK = eod.CONTRACT_BOOK
							AND DPD.REPORT_DATE <= eod.EOD_DATE
							--AND DPD.PROFIT_CENTER = eod.PROFIT_CENTER
							AND DPD.MATERIAL_GROUP = eod.COMMODITY
							) origindate
				FROM (
						SELECT DISTINCT DPA.CONTRACT_BOOK
										,DPA.PROFIT_CENTER
										,DPA.COMMODITY
			  							,DPA.EOD_DATE
							FROM DAILY_PNL_ATTRIBUTION DPA
							JOIN (SELECT distinct EOD_DATE
									FROM   DAILY_PNL_ATTRIBUTION B
									WHERE $X{IN,CONTRACT_BOOK,cbk}
									AND B.EOD_DATE >= $P{date_from}
									AND B.EOD_DATE <= $P{date_to}
									AND $X{IN,PROFIT_CENTER,pc}
									AND $X{IN,COMMODITY,cmd}
									) BVBV
							ON DPA.EOD_DATE = BVBV.EOD_DATE
							AND  $X{IN, DPA.CONTRACT_BOOK, cbk}
							AND $X{IN,PROFIT_CENTER,pc}
							AND $X{IN,COMMODITY,cmd}

					) eod
				WHERE 0=0
				$P!{QSTR_Filter}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,COMMODITY,cmd}
	)T2
	RIGHT JOIN
	(
SELECT COMMODITY,
       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(ABS_QTY) AS ABS_QTY,
       CATEGORY,
       ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT A.COMMODITY,
               A.ATTRIBUTION_DATE,
               A.QTY,
               Abs(A.QTY)     AS ABS_QTY,
               'Origin Stock' AS CATEGORY,
               0              AS ORDERBY,
               'Origin'       AS TYPE_OF_DATA
        FROM   (SELECT MATERIAL_GROUP AS COMMODITY,
                       REPORT_DATE    AS ATTRIBUTION_DATE,
                       Sum(QUANTITY)  AS QTY
                FROM   DM_POSITION_DATA
                WHERE  ORIGIN_DATA_TYPE = 'IV'
				AND	   0=0
                AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY MATERIAL_GROUP,
                          REPORT_DATE) A
        WHERE  ATTRIBUTION_DATE >= $P{date_from}
               AND ATTRIBUTION_DATE <= $P{date_to}
             AND $X{IN,COMMODITY,cmd}
         AND A.QTY <> 0
        UNION
        SELECT COALESCE(A.COMMODITY, B.COMMODITY)               AS COMMODITY,
               COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               Isnull(A.QTY, 0) - Isnull(B.QTY, 0)              AS QTY,
               Abs(Isnull(A.QTY, 0) - Isnull(B.QTY, 0))         AS ABS_QTY,
               'OIL Stock'                                      AS CATEGORY,
               1                                                AS ORDERBY,
               'OIL'                                            AS TYPE_OF_DATA
        FROM   (SELECT COMMODITY,
                       ALLOCATION_TYPE,
                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
                FROM   DAILY_PNL_ATTRIBUTION
                WHERE  ALLOCATION_TYPE = 'STOCK'
                       AND LONG_SHORT = 'LONG'
                       AND INSTRUMENT_TYPE = 'PHYSICAL'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND 0=0
                AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY COMMODITY,
                          ALLOCATION_TYPE,
                          EOD_DATE) A
               FULL JOIN (SELECT COMMODITY,
                                 ALLOCATION_TYPE,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
                          FROM   DAILY_PNL_ATTRIBUTION
                          WHERE  ALLOCATION_TYPE = 'STOCK'
                                 AND LONG_SHORT = 'SHORT'
                                 AND INSTRUMENT_TYPE = 'PHYSICAL'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND 0=0
                          AND $X{IN,PROFIT_CENTER,pc}
              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY COMMODITY,
                                    ALLOCATION_TYPE,
                                    EOD_DATE) B
                      ON A.COMMODITY = B.COMMODITY
                         AND A.ALLOCATION_TYPE = B.ALLOCATION_TYPE
                         AND A.ATTRIBUTION_DATE = B.ATTRIBUTION_DATE
       WHERE  COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) <= $P{date_to}
           AND Isnull(A.QTY,0) - Isnull(B.QTY,0) <> 0
           AND $X{IN,CASE WHEN A.COMMODITY IS NOT NULL THEN A.COMMODITY ELSE B.COMMODITY END,cmd}
       )STOCK
WHERE  QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
          CATEGORY,
          ORDERBY,
          TYPE_OF_DATA
UNION
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)      AS QTY,
       Sum(Abs(A.QTY)) AS ABS_QTY,
       'All Purchases' AS CATEGORY,
       2               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
	--Fixed Price Purchases
	SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)              AS QTY,
       --Sum(Abs(A.QTY))         AS ABS_QTY,
      -- 'Fixed Price Purchases' AS CATEGORY,
      --5                       AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'LONG'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
       WHERE  ORIGIN_DATA_TYPE IN ( 'PO')--,'IV' )
			   AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,PROFIT_CENTER,pc}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--Unpriced Purchases
	SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)           AS QTY,
       --Sum(Abs(A.QTY))      AS ABS_QTY,
       --'Unpriced Purchases' AS CATEGORY,
       --11                    AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'LONG'
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
			   AND ALLOCATION_ID = PRICING_ID
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}

         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,

                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE IN ( 'PO' )
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,PROFIT_CENTER,pc}

        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--DIff Purchases pending fixation
	SELECT  COMMODITY,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + COMMODITY,
		   MATERIAL_GROUP AS COMMODITY,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin'                                AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'PO')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,MATERIAL_GROUP,cmd}
	$P!{QSTR_Filter}
	GROUP  BY
          MATERIAL_GROUP,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL'                          AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'LONG'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}

	$P!{QSTR_Filter}
	GROUP  BY  COMMODITY,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
          --POSITION_TYPE,
          --ORDERBY,
		  TYPE_OF_DATA
				  ) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)     AS QTY,
       Sum(Abs(A.QTY)) AS ABS_QTY,
       'All Sales'     AS CATEGORY,
       3               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
--Fixed Priced Sales
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)         AS QTY,
       --Sum(Abs(A.QTY))     AS ABS_QTY,
       --'Fixed Price Sales' AS CATEGORY,
      -- 6                   AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'SHORT'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,PROFIT_CENTER,pc}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Unpriced Sales
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)      AS QTY,
       --Sum(Abs(A.QTY))  AS ABS_QTY,
       --'Unpriced Sales' AS CATEGORY,
       --12                AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'SHORT'
               AND ALLOCATION_ID = PRICING_ID
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
			    AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
				AND 0=0
			 AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,

                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,PROFIT_CENTER,pc}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Diff Sales Pending Fixation
SELECT  COMMODITY,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + COMMODITY,
		   MATERIAL_GROUP AS COMMODITY,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin'                                  AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'SO')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,MATERIAL_GROUP,cmd}
	$P!{QSTR_Filter}
	GROUP  BY
          MATERIAL_GROUP,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL'                                AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'SHORT'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}

	$P!{QSTR_Filter}
	GROUP  BY  COMMODITY,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA

) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT COMMODITY,

       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(Abs(QTY)) AS ABS_QTY,
       '   Net Physicals' AS CATEGORY,
       4 AS ORDERBY,
       TYPE_OF_DATA
FROM   (
SELECT COMMODITY,
       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       --Sum(ABS_QTY) AS ABS_QTY,
       --CATEGORY,
       --ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT A.COMMODITY,
               A.ATTRIBUTION_DATE,
               A.QTY,
               Abs(A.QTY)     AS ABS_QTY,
               'Origin Stock' AS CATEGORY,
               0              AS ORDERBY,
               TYPE_OF_DATA
        FROM   (SELECT MATERIAL_GROUP AS COMMODITY,
                       REPORT_DATE    AS ATTRIBUTION_DATE,
                       Sum(QUANTITY)  AS QTY,
					   'Origin' AS TYPE_OF_DATA
                FROM   DM_POSITION_DATA
                WHERE  ORIGIN_DATA_TYPE = 'IV'
				AND	   0=0
                AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY MATERIAL_GROUP,
                          REPORT_DATE) A
        WHERE  ATTRIBUTION_DATE >= $P{date_from}
               AND ATTRIBUTION_DATE <= $P{date_to}
             AND $X{IN,COMMODITY,cmd}
         AND A.QTY <> 0
        UNION
        SELECT COALESCE(A.COMMODITY, B.COMMODITY)               AS COMMODITY,
               COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               Isnull(A.QTY, 0) - Isnull(B.QTY, 0)              AS QTY,
               Abs(Isnull(A.QTY, 0) - Isnull(B.QTY, 0))         AS ABS_QTY,
               'OIL Stock'                                      AS CATEGORY,
               1                                                AS ORDERBY,
               'OIL'                                                AS TYPE_OF_DATA
        FROM   (SELECT COMMODITY,
                       ALLOCATION_TYPE,
                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
			    FROM   DAILY_PNL_ATTRIBUTION
                WHERE  ALLOCATION_TYPE = 'STOCK'
                       AND LONG_SHORT = 'LONG'
                       AND INSTRUMENT_TYPE = 'PHYSICAL'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND 0=0
                AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY COMMODITY,
                          ALLOCATION_TYPE,
                          EOD_DATE) A
               FULL JOIN (SELECT COMMODITY,
                                 ALLOCATION_TYPE,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY
                          FROM   DAILY_PNL_ATTRIBUTION
                          WHERE  ALLOCATION_TYPE = 'STOCK'
                                 AND LONG_SHORT = 'SHORT'
                                 AND INSTRUMENT_TYPE = 'PHYSICAL'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND 0=0
                          AND $X{IN,PROFIT_CENTER,pc}
              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY COMMODITY,
                                    ALLOCATION_TYPE,
                                    EOD_DATE) B
                      ON A.COMMODITY = B.COMMODITY
                         AND A.ALLOCATION_TYPE = B.ALLOCATION_TYPE
                         AND A.ATTRIBUTION_DATE = B.ATTRIBUTION_DATE
       WHERE  COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(A.ATTRIBUTION_DATE, B.ATTRIBUTION_DATE) <= $P{date_to}
           AND Isnull(A.QTY,0) - Isnull(B.QTY,0) <> 0
           AND $X{IN,CASE WHEN A.COMMODITY IS NOT NULL THEN A.COMMODITY ELSE B.COMMODITY END,cmd}
       )STOCK
WHERE  QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
          --CATEGORY,
         -- ORDERBY,
          TYPE_OF_DATA
UNION ALL
--All Purchases
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)      AS QTY,
       --Sum(Abs(A.QTY)) AS ABS_QTY,
       --'All Purchases' AS CATEGORY,
       --2               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
	--Fixed Price Purchases
	SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)              AS QTY,
       --Sum(Abs(A.QTY))         AS ABS_QTY,
      -- 'Fixed Price Purchases' AS CATEGORY,
      --5                       AS ORDERBY,
     TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'LONG'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
       WHERE  ORIGIN_DATA_TYPE IN ( 'PO')
			   AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,PROFIT_CENTER,pc}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--Unpriced Purchases		--VISHAL
	SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)           AS QTY,
       --Sum(Abs(A.QTY))      AS ABS_QTY,
       --'Unpriced Purchases' AS CATEGORY,
       --11                    AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'LONG'
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
			   AND ALLOCATION_ID = PRICING_ID
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}

         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,

                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE IN ('PO' )
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,PROFIT_CENTER,pc}

        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
	UNION ALL
	--DIff Purchases pending fixation
	SELECT  COMMODITY,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + COMMODITY,
		   MATERIAL_GROUP AS COMMODITY,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin'                                 AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'PO')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,MATERIAL_GROUP,cmd}
	$P!{QSTR_Filter}
	GROUP  BY
          MATERIAL_GROUP,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL'                                 AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'LONG'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}

	$P!{QSTR_Filter}
	GROUP  BY  COMMODITY,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
          --POSITION_TYPE,
          --ORDERBY,
		  TYPE_OF_DATA
				  ) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
--All Sales to come in
UNION ALL
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)     AS QTY,
       --Sum(Abs(A.QTY)) AS ABS_QTY,
       --'All Sales'     AS CATEGORY,
       --3               AS ORDERBY,
       TYPE_OF_DATA
FROM   (
--Fixed Priced Sales
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)         AS QTY,
       --Sum(Abs(A.QTY))     AS ABS_QTY,
       --'Fixed Price Sales' AS CATEGORY,
      -- 6                   AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'SHORT'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,PROFIT_CENTER,pc}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Unpriced Sales
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)      AS QTY,
       --Sum(Abs(A.QTY))  AS ABS_QTY,
       --'Unpriced Sales' AS CATEGORY,
       --12                AS ORDERBY,
      TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'SHORT'
               AND ALLOCATION_ID = PRICING_ID
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			   AND ALLOCATION_TYPE <> 'STOCK'
			    AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
				AND 0=0
			 AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,

                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP AS COMMODITY,

               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,PROFIT_CENTER,pc}

    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,

                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION ALL
--Diff Sales Pending Fixation
SELECT  COMMODITY,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		--Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		--POSITION_TYPE                            AS CATEGORY,
       -- ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN QUANTITY

				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + COMMODITY,
		   MATERIAL_GROUP AS COMMODITY,

		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'

			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE IN('PO')THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin'                                  AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
			AND --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
			A.ORIGIN_DATA_TYPE IN ( 'SO')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,PROFIT_CENTER,pc}
	AND $X{IN,MATERIAL_GROUP,cmd}
	$P!{QSTR_Filter}
	GROUP  BY
          MATERIAL_GROUP,

          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION ALL
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,

		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL'                                 AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND A.LONG_SHORT = 'SHORT'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}

	$P!{QSTR_Filter}
	GROUP  BY  COMMODITY,

               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA

) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
       )NET_PHYSICAL
WHERE  QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
          --CATEGORY,
          --ORDERBY,
          --TYPE_OF_DATA
UNION
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)              AS QTY,
       Sum(Abs(A.QTY))         AS ABS_QTY,
       'Fixed Price Purchases' AS CATEGORY,
       5                       AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'LONG'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   --AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP,
               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
       WHERE  ORIGIN_DATA_TYPE IN ( 'PO', 'IV')
			   AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,PROFIT_CENTER,pc}
    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,
                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)         AS QTY,
       Sum(Abs(A.QTY))     AS ABS_QTY,
       'Fixed Price Sales' AS CATEGORY,
       6                   AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
		LEFT JOIN DAILY_CONTRACT_DATA CTR
			ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  ( PRICING_TYPE = 'PRICED'
                  OR ( PRICING_TYPE = 'UNPRICED'
                       AND ALLOCATION_ID <> PRICING_ID ) )
               AND LONG_SHORT = 'SHORT'
               AND A.INSTRUMENT_TYPE = 'PHYSICAL'
			   --AND ALLOCATION_TYPE <> 'STOCK'
               AND CURRENT_OPEN_QUANTITY > 0
			   AND CTR_TYPE <> 'PAPER'
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP,
               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Priced'
        AND $X{IN,PROFIT_CENTER,pc}
    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,
                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT COMMODITY,
       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(ABS_QTY) AS ABS_QTY,
       CATEGORY,
       ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.COMMODITY, PSALES.COMMODITY, ORIGIN_PURCH.COMMODITY, ORIGIN_SALES.COMMODITY)                             AS COMMODITY,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Fixed Price Position'                                                                                           AS CATEGORY,
               7                                                                                                                       AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT COMMODITY,
                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
				FROM   DAILY_PNL_ATTRIBUTION A
				LEFT JOIN DAILY_CONTRACT_DATA CTR
					ON A.POSITION_ID = CTR.POSITION_ID
                WHERE  ( PRICING_TYPE = 'PRICED'
                          OR ( PRICING_TYPE = 'UNPRICED'
                               AND ALLOCATION_ID <> PRICING_ID ) )
                       AND LONG_SHORT = 'LONG'
                       AND A.INSTRUMENT_TYPE = 'PHYSICAL'
					   --AND ALLOCATION_TYPE <> 'STOCK'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND CTR_TYPE <> 'PAPER'
					   AND 0=0
                     AND $X{IN,PROFIT_CENTER,pc}
             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY COMMODITY,
                          EOD_DATE) PRICE
               FULL JOIN (SELECT COMMODITY,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'OIL' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION A
							LEFT JOIN DAILY_CONTRACT_DATA CTR
								ON A.POSITION_ID = CTR.POSITION_ID
                          WHERE  ( PRICING_TYPE = 'PRICED'
                                    OR ( PRICING_TYPE = 'UNPRICED'
                                         AND ALLOCATION_ID <> PRICING_ID ) )
                                 AND LONG_SHORT = 'SHORT'
                                 AND A.INSTRUMENT_TYPE = 'PHYSICAL'
								 --AND ALLOCATION_TYPE <> 'STOCK'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND CTR_TYPE <> 'PAPER'
								 AND 0=0
                                   AND $X{IN,PROFIT_CENTER,pc}
                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY COMMODITY,
                                    EOD_DATE) PSALES
                      ON PSALES.COMMODITY = PRICE.COMMODITY
                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  --ORIGIN_DATA_TYPE IN ( 'PO' )
						  ORIGIN_DATA_TYPE IN ( 'PO', 'IV' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,PROFIT_CENTER,pc}
              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,
                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.COMMODITY = PRICE.COMMODITY
                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,PROFIT_CENTER,pc}
              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,
                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.COMMODITY = PRICE.COMMODITY
                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.COMMODITY IS NOT NULL THEN PRICE.COMMODITY
         WHEN PSALES.COMMODITY IS NOT NULL THEN PSALES.COMMODITY
         WHEN ORIGIN_PURCH.COMMODITY IS NOT NULL THEN ORIGIN_PURCH.COMMODITY
         WHEN ORIGIN_SALES.COMMODITY IS NOT NULL THEN ORIGIN_SALES.COMMODITY
       END,cmd}
       )FIXED_PRICE
WHERE  QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
          CATEGORY,
          ORDERBY,
          TYPE_OF_DATA
UNION
SELECT  COMMODITY,
		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		Abs(sum(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA									 AS TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN QUANTITY
				 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN QUANTITY
				 ELSE -QUANTITY
			   END)                             AS QTY,
		   CONTRACT_BOOK,
		   --CONTRACT_BOOK + ' ' + MATERIAL_GROUP AS COMMODITY,
		   MATERIAL_GROUP AS COMMODITY,
		   CASE
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Purchase Contract - Differential Price as of Today'
			 --WHEN A.ORIGIN_DATA_TYPE = 'PO' THEN 'Diff Purchases Pending Fixation'
			 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                  AS POSITION_TYPE,
		   0                                    AS FLAG,
		   CASE
			 WHEN A.ORIGIN_DATA_TYPE  IN('PO','IV') THEN 8
			 ELSE 9
		   END                                  AS ORDERBY,
		    'Origin'                                  AS TYPE_OF_DATA,
		   'Origin Position'                    AS POSITION,
		   A.REPORT_DATE						AS ATTRIBUTION_DATE
	FROM   DM_POSITION_DATA A
	WHERE  PRICED_UNPRICED = 'Unpriced'
		   --AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO')
		   AND A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
		   AND	   0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,MATERIAL_GROUP,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY
          MATERIAL_GROUP,
          A.ORIGIN_DATA_TYPE,
          CONTRACT_BOOK,
		  A.REPORT_DATE
	UNION
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,
		   CASE
			 --WHEN A.LONG_SHORT = 'LONG' THEN 'Purchase Contract - Differential Price as of Today'
			 WHEN A.LONG_SHORT = 'LONG' THEN 'Diff Purchases Pending Fixation'
			 ELSE 'Diff Sales Pending Fixation'
		   END                                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   CASE
			 WHEN A.LONG_SHORT = 'LONG' THEN 8
			 ELSE 9
		   END                                 AS ORDERBY,
		    'OIL'                                 AS TYPE_OF_DATA,
		   'OIL Position'                      AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   --AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND PRICING_TYPE = 'UNPRICED'
		   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
		   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
		   AND ALLOCATION_ID = PRICING_ID
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY  COMMODITY,
               CONTRACT_BOOK,
			   LONG_SHORT,
			   A.EOD_DATE
	) DIFF_PURCHASE_SALE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
          POSITION_TYPE,
          ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT  COMMODITY,
		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		Abs(sum(Isnull(QTY, 0)))				 AS ABS_QTY,
		POSITION								 AS CATEGORY,
        ORDERBY                                  AS ORDERBY,
		TYPE_OF_DATA								     AS TYPE_OF_DATA

FROM
(
		SELECT Sum(QTY)                                AS QTY,
			   CTR.CONTRACT_BOOK AS CONTRACT_BOOK,
			   --CTR.CONTRACT_BOOK + ' ' + CTR.COMMODITY AS COMMODITY,
			   CTR.COMMODITY AS COMMODITY,
			   NULL                                    AS POSITION_TYPE,
			   1                                       AS FLAG,
			   10                                      AS ORDERBY,
			   TYPE_OF_DATA,
			   --'Net Differential Price Position'       AS POSITION,
			   '   Net Diff Position'       AS POSITION,
			   ATTRIBUTION_DATE
		FROM   (SELECT Sum(CASE
							--WHEN LONG_SHORT = 'Long' THEN QUANTITY
							--ELSE -QUANTITY
							 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN QUANTITY
							 ELSE -QUANTITY
						   END)       AS QTY,
						   'Origin' AS TYPE_OF_DATA,
					   CONTRACT_BOOK,
					   MATERIAL_GROUP AS COMMODITY,
					   A.REPORT_DATE						AS ATTRIBUTION_DATE
				FROM   DM_POSITION_DATA A
				WHERE  --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
					   A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
					   AND	   0=0
					   AND PRICED_UNPRICED = 'Unpriced'
				AND $X{IN,CONTRACT_BOOK,cbk}
				AND $X{IN,MATERIAL_GROUP,cmd}
				AND $X{IN,PROFIT_CENTER,pc}
				$P!{QSTR_Filter}
				GROUP  BY MATERIAL_GROUP,
						  CONTRACT_BOOK,
						  A.REPORT_DATE
				UNION
				SELECT Sum(CASE
							 WHEN LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						   END) AS QTY,
						   'OIL' AS TYPE_OF_DATA,
					   A.CONTRACT_BOOK,
					   A.COMMODITY,
					   A.EOD_DATE						AS ATTRIBUTION_DATE
				FROM   DAILY_PNL_ATTRIBUTION A
					   LEFT JOIN DAILY_CONTRACT_DATA CTR
							  ON A.POSITION_ID = CTR.POSITION_ID
				WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
					   AND A.ALLOCATION_TYPE IS NOT NULL
					   --AND A.ALLOCATION_TYPE <> 'STOCK'
					   AND PRICING_TYPE = 'UNPRICED'
					   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
					   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
					   AND ALLOCATION_ID = PRICING_ID
					   AND 0=0
				AND $X{IN,A.CONTRACT_BOOK,cbk}
				AND $X{IN,COMMODITY,cmd}
				AND $X{IN,PROFIT_CENTER,pc}
				$P!{QSTR_Filter}
				GROUP  BY COMMODITY,
						  CONTRACT_BOOK,
						  A.EOD_DATE
				)CTR
GROUP  BY CTR.COMMODITY,
          CTR.ATTRIBUTION_DATE,
		  CTR.CONTRACT_BOOK,
		  CTR.TYPE_OF_DATA
) NDPP
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
          POSITION,
          ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(A.QTY)           AS QTY,
       Sum(Abs(A.QTY))      AS ABS_QTY,
       'Unpriced Purchases' AS CATEGORY,
       11                    AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'LONG'
               AND INSTRUMENT_TYPE = 'PHYSICAL'
               AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
			   AND ALLOCATION_ID = PRICING_ID
			   AND 0=0
             AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP,
               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE IN ( 'IV', 'PO' )
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,PROFIT_CENTER,pc}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,
                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT A.COMMODITY,
       A.ATTRIBUTION_DATE,
       Sum(-A.QTY)      AS QTY,
       Sum(Abs(A.QTY))  AS ABS_QTY,
       'Unpriced Sales' AS CATEGORY,
       12                AS ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COMMODITY,
               EOD_DATE                                                AS ATTRIBUTION_DATE,
               Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
			   'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION
        WHERE  PRICING_TYPE = 'UNPRICED'
               AND LONG_SHORT = 'SHORT'
               AND ALLOCATION_ID = PRICING_ID
               AND INSTRUMENT_TYPE = 'PHYSICAL'
			    AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                      OR BASIS_MARKET_PRICE_INDEX = 'NA' )
				AND 0=0
			 AND $X{IN,PROFIT_CENTER,pc}
         AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY COMMODITY,
                  EOD_DATE
        UNION
        SELECT MATERIAL_GROUP,
               REPORT_DATE   AS ATTRIBUTION_DATE,
               Sum(QUANTITY) AS QTY,
			   'Origin' AS TYPE_OF_DATA
        FROM   DM_POSITION_DATA
        WHERE  ORIGIN_DATA_TYPE = 'SO'
		AND	   0=0
               AND PRICED_UNPRICED = 'Unpriced'
        AND $X{IN,PROFIT_CENTER,pc}
    AND $X{IN,CONTRACT_BOOK,cbk}
        $P!{QSTR_Filter}
        GROUP  BY MATERIAL_GROUP,
                  REPORT_DATE) A
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
     AND $X{IN,COMMODITY,cmd}
     AND A.QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  TYPE_OF_DATA
UNION
SELECT COMMODITY,
       ATTRIBUTION_DATE,
       Sum(QTY)     AS QTY,
       Sum(ABS_QTY) AS ABS_QTY,
       CATEGORY,
       ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.COMMODITY, PSALES.COMMODITY, ORIGIN_PURCH.COMMODITY, ORIGIN_SALES.COMMODITY)                             AS COMMODITY,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Unpriced Position'                                                                                              AS CATEGORY,
               13                                                                                                                      AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT COMMODITY,
                       PRICING_TYPE,
                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
                FROM   DAILY_PNL_ATTRIBUTION
                WHERE  PRICING_TYPE = 'UNPRICED'
                       AND LONG_SHORT = 'LONG'
                       AND ALLOCATION_ID = PRICING_ID
                       AND INSTRUMENT_TYPE = 'PHYSICAL'
                       --AND CURRENT_OPEN_QUANTITY > 0
					   AND ( BASIS_MARKET_PRICE_INDEX IS NULL
                       OR BASIS_MARKET_PRICE_INDEX = 'NA' )
					   AND 0=0
                     AND $X{IN,PROFIT_CENTER,pc}
             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY COMMODITY,
                          PRICING_TYPE,
                          EOD_DATE) PRICE
               FULL JOIN (SELECT COMMODITY,
                                 PRICING_TYPE,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'OIL' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION
					      WHERE  PRICING_TYPE = 'UNPRICED'
                                 AND LONG_SHORT = 'SHORT'
                                 AND ALLOCATION_ID = PRICING_ID
                                 AND INSTRUMENT_TYPE = 'PHYSICAL'
                                 --AND CURRENT_OPEN_QUANTITY > 0
								 AND ( BASIS_MARKET_PRICE_INDEX IS NULL
									OR BASIS_MARKET_PRICE_INDEX = 'NA' )
								 AND 0=0
                                   AND $X{IN,PROFIT_CENTER,pc}
                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY COMMODITY,
                                    PRICING_TYPE,
                                    EOD_DATE) PSALES
                      ON PSALES.COMMODITY = PRICE.COMMODITY
                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE IN ( 'IV', 'PO' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Unpriced'
                          AND $X{IN,PROFIT_CENTER,pc}
              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,
                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.COMMODITY = PRICE.COMMODITY
                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Unpriced'
                          AND $X{IN,PROFIT_CENTER,pc}
              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,
                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.COMMODITY = PRICE.COMMODITY
                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.COMMODITY IS NOT NULL THEN PRICE.COMMODITY
         WHEN PSALES.COMMODITY IS NOT NULL THEN PSALES.COMMODITY
         WHEN ORIGIN_PURCH.COMMODITY IS NOT NULL THEN ORIGIN_PURCH.COMMODITY
         WHEN ORIGIN_SALES.COMMODITY IS NOT NULL THEN ORIGIN_SALES.COMMODITY
       END,cmd}
       )NET_UNPRICED_POSITION
WHERE  QTY <> 0
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
          CATEGORY,
          ORDERBY,
          TYPE_OF_DATA
UNION
SELECT  COMMODITY,
		ATTRIBUTION_DATE,
		Sum(Isnull(QTY, 0))      AS QTY,
		Sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        ORDERBY                                  AS ORDERBY,
        TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
			   'OIL' AS TYPE_OF_DATA,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,
		   'Futures'                           AS POSITION_TYPE,
		   0                                   AS FLAG,
		   14                                  AS ORDERBY,
		   'Net Derivatives Position'          AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	AND 0=0
	$P!{QSTR_Filter}
	GROUP  BY A.COMMODITY,
			  A.CONTRACT_BOOK,
			  A.EOD_DATE
) FUTURES
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  POSITION_TYPE,
		  ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT  COMMODITY,
		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        ORDERBY                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
			   'OIL' AS TYPE_OF_DATA,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,
		   'Listed Options Delta'              AS POSITION_TYPE,
		   0                                   AS FLAG,
		   15                                  AS ORDERBY,
		   'Net Derivatives Position'          AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
	AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
	GROUP  BY A.COMMODITY,
			  A.CONTRACT_BOOK,
			  A.EOD_DATE
	) LISTED_OPTIONS_DELTA
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  POSITION_TYPE,
		  ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT  COMMODITY,
		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION_TYPE                            AS CATEGORY,
        16                                      AS ORDERBY,
        TYPE_OF_DATA
FROM
(
	SELECT Sum(CASE
				 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
				 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
			   END)                            AS QTY,
			   'OIL' AS TYPE_OF_DATA,
		   A.CONTRACT_BOOK,
		   --A.CONTRACT_BOOK + ' ' + A.COMMODITY AS COMMODITY,
		   A.COMMODITY AS COMMODITY,
		   'Paper Trades'                 AS POSITION_TYPE,
		   0                                   AS FLAG,
		   16                                  AS ORDERBY,
		   'Net Derivatives Position'          AS POSITION,
		   A.EOD_DATE							   AS ATTRIBUTION_DATE
	FROM   DAILY_PNL_ATTRIBUTION A
		   LEFT JOIN DAILY_CONTRACT_DATA CTR
				  ON A.POSITION_ID = CTR.POSITION_ID
	WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		   --AND LONG_SHORT = 'LONG'
		   AND A.ALLOCATION_TYPE <> 'STOCK'
		   AND CTR_TYPE = 'PAPER'
		   AND 0=0
	AND $X{IN,CONTRACT_BOOK,cbk}
	AND $X{IN,COMMODITY,cmd}
	AND $X{IN,PROFIT_CENTER,pc}
	$P!{QSTR_Filter}
GROUP  BY A.COMMODITY,
		A.CONTRACT_BOOK,
		A.EOD_DATE
	) PAPER_TRADES
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  POSITION_TYPE,
		  ORDERBY,
		  TYPE_OF_DATA
UNION
SELECT  COMMODITY,
		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        17                                       AS ORDERBY,
        NDP.TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.COMMODITY AS COMMODITY,
	   CTR.COMMODITY AS COMMODITY,
       NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       17                                      AS ORDERBY,
       '   Net Derivatives Position'              AS POSITION,
	   CTR.EOD_DATE							   AS ATTRIBUTION_DATE,
	   'OIL' AS TYPE_OF_DATA
FROM   (SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
               A.CONTRACT_BOOK,
               A.COMMODITY,
			   A.EOD_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
		AND 0=0
        AND $X{IN,CONTRACT_BOOK,cbk}
        AND $X{IN,COMMODITY,cmd}
        AND $X{IN,PROFIT_CENTER,pc}
        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,
				  A.CONTRACT_BOOK,
                  A.EOD_DATE
        UNION
        SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
               A.CONTRACT_BOOK,
               A.COMMODITY,
			   A.EOD_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
		AND 0=0
        AND $X{IN,CONTRACT_BOOK,cbk}
        AND $X{IN,COMMODITY,cmd}
        AND $X{IN,PROFIT_CENTER,pc}
        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,
				  A.CONTRACT_BOOK,
                  A.EOD_DATE
        UNION
        SELECT --Sum(( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )) AS QTY,
				SUM(CASE
					 WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
					 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
					END)                            AS QTY,
               A.CONTRACT_BOOK,
               A.COMMODITY,
			   A.EOD_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
               --AND LONG_SHORT = 'LONG'
               AND A.ALLOCATION_TYPE <> 'STOCK'
               AND CTR_TYPE = 'PAPER'
			   AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,COMMODITY,cmd}
        AND $X{IN,PROFIT_CENTER,pc}
        $P!{QSTR_Filter}
		GROUP  BY A.COMMODITY,
		A.CONTRACT_BOOK,
		A.EOD_DATE
		) CTR
GROUP  BY COMMODITY,
		  CONTRACT_BOOK,
		  EOD_DATE
	) NDP
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
UNION
SELECT  COMMODITY,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        18                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       --CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.COMMODITY AS COMMODITY,
	   CTR.COMMODITY AS COMMODITY,

	   CTR.ATTRIBUTION_DATE						AS ATTRIBUTION_DATE,
		NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       18                                      AS ORDERBY,
       '   Outright Position'                     AS POSITION,
	   TYPE_OF_DATA
FROM   (SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
               --A.CONTRACT_BOOK,
               A.COMMODITY,

			   A.EOD_DATE AS ATTRIBUTION_DATE,
			    'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
               --A.CONTRACT_BOOK,
               A.COMMODITY,

			   A.EOD_DATE AS ATTRIBUTION_DATE,
			    'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT --Sum(( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )) AS QTY,
				SUM(CASE
							WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						END)                            AS QTY,
               --A.CONTRACT_BOOK,
               A.COMMODITY,

               A.EOD_DATE AS ATTRIBUTION_DATE,
			    'OIL' AS TYPE_OF_DATA
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		AND 0=0
               --AND LONG_SHORT = 'LONG'
               AND A.ALLOCATION_TYPE <> 'STOCK'
               AND CTR_TYPE = 'PAPER'
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT
		Sum(QTY)     AS QTY,
		COMMODITY,

       ATTRIBUTION_DATE,

       --Sum(ABS_QTY) AS ABS_QTY,
       --CATEGORY,
       --ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.COMMODITY, PSALES.COMMODITY, ORIGIN_PURCH.COMMODITY, ORIGIN_SALES.COMMODITY)                             AS COMMODITY,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Fixed Price Position'                                                                                           AS CATEGORY,
               7                                                                                                                       AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT COMMODITY,

                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
                FROM   DAILY_PNL_ATTRIBUTION A
				LEFT JOIN DAILY_CONTRACT_DATA CTR
					ON A.POSITION_ID = CTR.POSITION_ID
                WHERE  ( PRICING_TYPE = 'PRICED'
                          OR ( PRICING_TYPE = 'UNPRICED'
                               AND ALLOCATION_ID <> PRICING_ID ) )
                       AND LONG_SHORT = 'LONG'
                       AND A.INSTRUMENT_TYPE = 'PHYSICAL'
					   --AND ALLOCATION_TYPE <> 'STOCK'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND CTR_TYPE <> 'PAPER'
					   AND 0=0
                     AND $X{IN,PROFIT_CENTER,pc}

             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY COMMODITY,

                          EOD_DATE) PRICE
               FULL JOIN (SELECT COMMODITY,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'OIL' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION A
							LEFT JOIN DAILY_CONTRACT_DATA CTR
								ON A.POSITION_ID = CTR.POSITION_ID
                          WHERE  ( PRICING_TYPE = 'PRICED'
                                    OR ( PRICING_TYPE = 'UNPRICED'
                                         AND ALLOCATION_ID <> PRICING_ID ) )
                                 AND LONG_SHORT = 'SHORT'
                                 AND A.INSTRUMENT_TYPE = 'PHYSICAL'
								 --AND ALLOCATION_TYPE <> 'STOCK'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND CTR_TYPE <> 'PAPER'
								 AND 0=0
                                   AND $X{IN,PROFIT_CENTER,pc}
                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY COMMODITY,
                                    EOD_DATE) PSALES
                      ON PSALES.COMMODITY = PRICE.COMMODITY
                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  --ORIGIN_DATA_TYPE IN ( 'PO' )
						  ORIGIN_DATA_TYPE IN ( 'PO', 'IV' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,PROFIT_CENTER,pc}
						  AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,
                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.COMMODITY = PRICE.COMMODITY

                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,PROFIT_CENTER,pc}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,

                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.COMMODITY = PRICE.COMMODITY

                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.COMMODITY IS NOT NULL THEN PRICE.COMMODITY
         WHEN PSALES.COMMODITY IS NOT NULL THEN PSALES.COMMODITY
         WHEN ORIGIN_PURCH.COMMODITY IS NOT NULL THEN ORIGIN_PURCH.COMMODITY
         WHEN ORIGIN_SALES.COMMODITY IS NOT NULL THEN ORIGIN_SALES.COMMODITY
       END,cmd}
       )FIXED_PRICE
WHERE  QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
         -- CATEGORY,
         -- ORDERBY,
         TYPE_OF_DATA
        ) CTR
GROUP  BY CTR.COMMODITY,
         -- CTR.CONTRACT_BOOK,
		  CTR.ATTRIBUTION_DATE,
		  CTR.TYPE_OF_DATA
		  ) OUTRIGHT
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
UNION
SELECT  COMMODITY,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        19                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       --CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.COMMODITY AS COMMODITY,
	   CTR.COMMODITY AS COMMODITY,

	   CTR.ATTRIBUTION_DATE						AS ATTRIBUTION_DATE,
       NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       19                                      AS ORDERBY,
       '   Basis Position'						   AS POSITION,
	   TYPE_OF_DATA
FROM   (
		--Net Fixed Price calulation
SELECT
		Sum(QTY)     AS QTY,
		COMMODITY,

       ATTRIBUTION_DATE,

       --Sum(ABS_QTY) AS ABS_QTY,
       --CATEGORY,
       --ORDERBY,
       TYPE_OF_DATA
FROM   (SELECT COALESCE(PRICE.COMMODITY, PSALES.COMMODITY, ORIGIN_PURCH.COMMODITY, ORIGIN_SALES.COMMODITY)                             AS COMMODITY,
               COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) AS ATTRIBUTION_DATE,
               COALESCE(ORIGIN_PURCH.QTY, 0)
               + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0)                                      AS QTY,
               Abs(COALESCE(ORIGIN_PURCH.QTY, 0)
                   + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0))                                 AS ABS_QTY,
               '   Net Fixed Price Position'                                                                                           AS CATEGORY,
               7                                                                                                                       AS ORDERBY,
               COALESCE(PRICE.TYPE_OF_DATA, PSALES.TYPE_OF_DATA, ORIGIN_PURCH.TYPE_OF_DATA, ORIGIN_SALES.TYPE_OF_DATA) AS TYPE_OF_DATA
        FROM   (SELECT COMMODITY,

                       EOD_DATE                                                AS ATTRIBUTION_DATE,
                       Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
					   'OIL' AS TYPE_OF_DATA
                FROM   DAILY_PNL_ATTRIBUTION A
				LEFT JOIN DAILY_CONTRACT_DATA CTR
					ON A.POSITION_ID = CTR.POSITION_ID
                WHERE  ( PRICING_TYPE = 'PRICED'
                          OR ( PRICING_TYPE = 'UNPRICED'
                               AND ALLOCATION_ID <> PRICING_ID ) )
                       AND LONG_SHORT = 'LONG'
                       AND A.INSTRUMENT_TYPE = 'PHYSICAL'
					   --AND ALLOCATION_TYPE <> 'STOCK'
                       AND CURRENT_OPEN_QUANTITY > 0
					   AND CTR_TYPE <> 'PAPER'
					   AND 0=0
                     AND $X{IN,PROFIT_CENTER,pc}

             AND $X{IN,CONTRACT_BOOK,cbk}
                $P!{QSTR_Filter}
                GROUP  BY COMMODITY,

                          EOD_DATE) PRICE
               FULL JOIN (SELECT COMMODITY,
                                 EOD_DATE                                                AS ATTRIBUTION_DATE,
                                 Sum(CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT) AS QTY,
								 'OIL' AS TYPE_OF_DATA
                          FROM   DAILY_PNL_ATTRIBUTION A
							LEFT JOIN DAILY_CONTRACT_DATA CTR
								ON A.POSITION_ID = CTR.POSITION_ID
                          WHERE  ( PRICING_TYPE = 'PRICED'
                                    OR ( PRICING_TYPE = 'UNPRICED'
                                         AND ALLOCATION_ID <> PRICING_ID ) )
                                 AND LONG_SHORT = 'SHORT'
                                 AND A.INSTRUMENT_TYPE = 'PHYSICAL'
								 --AND ALLOCATION_TYPE <> 'STOCK'
                                 AND CURRENT_OPEN_QUANTITY > 0
								 AND CTR_TYPE <> 'PAPER'
								 AND 0=0
                                   AND $X{IN,PROFIT_CENTER,pc}
                     AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY COMMODITY,
                                    EOD_DATE) PSALES
                      ON PSALES.COMMODITY = PRICE.COMMODITY
                         AND PSALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  --ORIGIN_DATA_TYPE IN ( 'PO' )
						  ORIGIN_DATA_TYPE IN ( 'PO', 'IV' )
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,PROFIT_CENTER,pc}
						  AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,
                                    REPORT_DATE) ORIGIN_PURCH
                      ON ORIGIN_PURCH.COMMODITY = PRICE.COMMODITY

                         --AND ORIGIN_PURCH.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_PURCH.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
               FULL JOIN (SELECT MATERIAL_GROUP AS COMMODITY,
                                 REPORT_DATE    AS ATTRIBUTION_DATE,
                                 Sum(QUANTITY)  AS QTY,
								 'Origin' AS TYPE_OF_DATA
                          FROM   DM_POSITION_DATA
                          WHERE  ORIGIN_DATA_TYPE = 'SO'
						  AND	   0=0
                                 AND PRICED_UNPRICED = 'Priced'
                          AND $X{IN,PROFIT_CENTER,pc}

              AND $X{IN,CONTRACT_BOOK,cbk}
                          $P!{QSTR_Filter}
                          GROUP  BY MATERIAL_GROUP,

                                    REPORT_DATE) ORIGIN_SALES
                      ON ORIGIN_SALES.COMMODITY = PRICE.COMMODITY

                         --AND ORIGIN_SALES.ATTRIBUTION_DATE = PRICE.ATTRIBUTION_DATE
						 AND ORIGIN_SALES.ATTRIBUTION_DATE <=(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
																FROM DM_POSITION_DATA DPD
																WHERE DPD.REPORT_DATE <= PRICE.ATTRIBUTION_DATE
																)
       WHERE  COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) >= $P{date_from}
              AND COALESCE(PRICE.ATTRIBUTION_DATE, PSALES.ATTRIBUTION_DATE, ORIGIN_PURCH.ATTRIBUTION_DATE, ORIGIN_SALES.ATTRIBUTION_DATE) <= $P{date_to}
           AND COALESCE(ORIGIN_PURCH.QTY, 0) + COALESCE(PRICE.QTY, 0) - COALESCE(PSALES.QTY, 0) - COALESCE(ORIGIN_SALES.QTY, 0) <> 0
           AND $X{IN,CASE WHEN PRICE.COMMODITY IS NOT NULL THEN PRICE.COMMODITY
         WHEN PSALES.COMMODITY IS NOT NULL THEN PSALES.COMMODITY
         WHEN ORIGIN_PURCH.COMMODITY IS NOT NULL THEN ORIGIN_PURCH.COMMODITY
         WHEN ORIGIN_SALES.COMMODITY IS NOT NULL THEN ORIGIN_SALES.COMMODITY
       END,cmd}
       )FIXED_PRICE
WHERE  QTY <> 0
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
         -- CATEGORY,
         -- ORDERBY,
         TYPE_OF_DATA
        UNION ALL
		----Net Diff calulation
        SELECT Sum(CASE
							 --WHEN LONG_SHORT = 'Long' THEN QUANTITY
							 --ELSE -QUANTITY
							 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN QUANTITY
							 ELSE -QUANTITY
						   END)       AS QTY,
					   --CONTRACT_BOOK,
					   MATERIAL_GROUP AS COMMODITY,

					   A.REPORT_DATE						AS ATTRIBUTION_DATE,
					   'Origin' AS TYPE_OF_DATA
				FROM   DM_POSITION_DATA A
				WHERE  --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
					   A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
					   AND	   0=0
					   AND PRICED_UNPRICED = 'Unpriced'
				AND $X{IN,CONTRACT_BOOK,cbk}
				AND $X{IN,MATERIAL_GROUP,cmd}
				AND $X{IN,PROFIT_CENTER,pc}

				$P!{QSTR_Filter}
				GROUP  BY MATERIAL_GROUP,

						  --CONTRACT_BOOK,
						  A.REPORT_DATE
				UNION ALL
				SELECT Sum(CASE
							 WHEN LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							 ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						   END) AS QTY,
					   --A.CONTRACT_BOOK,
					   A.COMMODITY,

					   A.EOD_DATE						AS ATTRIBUTION_DATE,
					   'OIL' AS TYPE_OF_DATA
				FROM   DAILY_PNL_ATTRIBUTION A
					   LEFT JOIN DAILY_CONTRACT_DATA CTR
							  ON A.POSITION_ID = CTR.POSITION_ID
				WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
					   AND A.ALLOCATION_TYPE IS NOT NULL
					   --AND A.ALLOCATION_TYPE <> 'STOCK'
					   AND PRICING_TYPE = 'UNPRICED'
					   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
					   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
					   AND ALLOCATION_ID = PRICING_ID
					   AND 0=0
				AND $X{IN,A.CONTRACT_BOOK,cbk}
				AND $X{IN,COMMODITY,cmd}
				AND $X{IN,PROFIT_CENTER,pc}

				$P!{QSTR_Filter}
				GROUP  BY COMMODITY,

						  --CONTRACT_BOOK,
						  A.EOD_DATE
				  )CTR
GROUP  BY CTR.COMMODITY,
          --CTR.CONTRACT_BOOK,
		  CTR.ATTRIBUTION_DATE,
		  CTR.TYPE_OF_DATA
		  ) BASIS
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,

          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
UNION
SELECT  COMMODITY,

		ATTRIBUTION_DATE,
		sum(Isnull(QTY, 0))      AS QTY,
		sum(Abs(Isnull(QTY, 0)))			AS ABS_QTY,
		POSITION								 AS CATEGORY,
        20                                       AS ORDERBY,
        TYPE_OF_DATA
FROM
(
SELECT Sum(QTY)                                AS QTY,
       --CTR.CONTRACT_BOOK,
       --CTR.CONTRACT_BOOK + ' ' + CTR.COMMODITY AS COMMODITY,
	   CTR.COMMODITY AS COMMODITY,

	   CTR.ATTRIBUTION_DATE						AS ATTRIBUTION_DATE,
       NULL                                    AS POSITION_TYPE,
       1                                       AS FLAG,
       20                                      AS ORDERBY,
       '   Structure Position'                    AS POSITION,
	   TYPE_OF_DATA
FROM   (SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
				   'OIL' AS TYPE_OF_DATA,
               --A.CONTRACT_BOOK,
               A.COMMODITY,

			   A.EOD_DATE AS ATTRIBUTION_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'FUTURES'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT Sum(CASE
                     WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                     ELSE -( CURRENT_OPEN_QUANTITY * CURRENT_DELTA * UOM_FACTOR_FROM_POS_TO_RPT )
                   END) AS QTY,
				   'OIL' AS TYPE_OF_DATA,
               --A.CONTRACT_BOOK,
               A.COMMODITY,

			   A.EOD_DATE AS ATTRIBUTION_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'OPTIONS'
		AND 0=0
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION
        SELECT --Sum(( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )) AS QTY,
				SUM(CASE
							WHEN A.LONG_SHORT = 'LONG' THEN ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							ELSE -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						END)                            AS QTY,
						'OIL' AS TYPE_OF_DATA,
               --A.CONTRACT_BOOK,
               A.COMMODITY,

               A.EOD_DATE AS ATTRIBUTION_DATE
        FROM   DAILY_PNL_ATTRIBUTION A
               LEFT JOIN DAILY_CONTRACT_DATA CTR
                      ON A.POSITION_ID = CTR.POSITION_ID
        WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
		AND 0=0
               --AND LONG_SHORT = 'LONG'
               AND A.ALLOCATION_TYPE <> 'STOCK'
               AND CTR_TYPE = 'PAPER'
        AND $X{IN,A.CONTRACT_BOOK,cbk}
        AND $X{IN,PROFIT_CENTER,pc}
        AND $X{IN,COMMODITY,cmd}

        $P!{QSTR_Filter}
        GROUP  BY A.COMMODITY,

                  --A.CONTRACT_BOOK,
				  A.EOD_DATE
        UNION ALL
        SELECT Sum(CASE
							 --WHEN LONG_SHORT = 'Long' THEN QUANTITY
							 --ELSE -QUANTITY
							 WHEN A.ORIGIN_DATA_TYPE IN('PO','IV') THEN -QUANTITY
							 ELSE QUANTITY
						   END)       AS QTY,
						   'Origin' AS TYPE_OF_DATA,
					   --CONTRACT_BOOK,
					   MATERIAL_GROUP AS COMMODITY,

					   A.REPORT_DATE						AS ATTRIBUTION_DATE
				FROM   DM_POSITION_DATA A
				WHERE  --A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO' )
					   A.ORIGIN_DATA_TYPE IN ( 'PO', 'SO','IV')
					   AND	   0=0
					   AND PRICED_UNPRICED = 'Unpriced'
				AND $X{IN,CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,MATERIAL_GROUP,cmd}

				$P!{QSTR_Filter}
				GROUP  BY MATERIAL_GROUP,

						  --CONTRACT_BOOK,
						  A.REPORT_DATE
				UNION ALL
				SELECT Sum(CASE
							 WHEN LONG_SHORT = 'LONG' THEN -( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
							 ELSE ( CURRENT_OPEN_QUANTITY * UOM_FACTOR_FROM_POS_TO_RPT )
						   END) AS QTY,
						   'OIL' AS TYPE_OF_DATA,
					   --A.CONTRACT_BOOK,
					   A.COMMODITY,

					   A.EOD_DATE						AS ATTRIBUTION_DATE
				FROM   DAILY_PNL_ATTRIBUTION A
					   LEFT JOIN DAILY_CONTRACT_DATA CTR
							  ON A.POSITION_ID = CTR.POSITION_ID
				WHERE  A.INSTRUMENT_TYPE = 'PHYSICAL'
					   AND A.ALLOCATION_TYPE IS NOT NULL
					   --AND A.ALLOCATION_TYPE <> 'STOCK'
					   AND PRICING_TYPE = 'UNPRICED'
					   AND BASIS_MARKET_PRICE_INDEX IS NOT NULL
					   AND BASIS_MARKET_PRICE_INDEX <> 'NA'
					   AND ALLOCATION_ID = PRICING_ID
					   AND 0=0
				AND $X{IN,A.CONTRACT_BOOK,cbk}
				AND $X{IN,PROFIT_CENTER,pc}
				AND $X{IN,COMMODITY,cmd}

				$P!{QSTR_Filter}
				GROUP  BY COMMODITY,

						  --CONTRACT_BOOK,
						  A.EOD_DATE) CTR
GROUP  BY CTR.COMMODITY,
          --CTR.CONTRACT_BOOK,
		    --CTR.SHIP_MONTH,
          --CTR.MONTHNUMBER,
		  CTR.ATTRIBUTION_DATE,
		  CTR.TYPE_OF_DATA
		  ) STRUCTURE
WHERE  ATTRIBUTION_DATE >= $P{date_from}
       AND ATTRIBUTION_DATE <= $P{date_to}
GROUP  BY COMMODITY,
          ATTRIBUTION_DATE,
		  POSITION,
		  TYPE_OF_DATA
		  )T1
ON (T1.ATTRIBUTION_DATE = T2.asofdate AND T1.TYPE_OF_DATA = 'OIL' AND T1.COMMODITY = T2.COMMODITY)
	OR
  --(ISNULL(T1.ATTRIBUTION_DATE,T2.origindate) = T2.origindate AND T1.TYPE_OF_DATA = 'Origin' AND T1.COMMODITY = T2.COMMODITY)
   (T1.ATTRIBUTION_DATE = T2.origindate AND T1.TYPE_OF_DATA = 'Origin' AND T1.COMMODITY = T2.COMMODITY)
WHERE T2.COMMODITY IS NOT NULL
GROUP  BY   T2.COMMODITY,
			--T1.ATTRIBUTION_DATE,
			T2.asofdate,
			--T2.origindate,
			--T1.ATTRIBUTION_DATE,
			CATEGORY,
			--TYPE_OF_DATA,
			 T1.QTY,
		    T1.ABS_QTY,
			ORDERBY]]>
		</queryString>
		<field name="COMMODITY" class="java.lang.String"/>
		<field name="ATTRIBUTION_DATE" class="java.sql.Date"/>
		<field name="QTY" class="java.math.BigDecimal"/>
		<field name="ABS_QTY" class="java.math.BigDecimal"/>
		<field name="CATEGORY" class="java.lang.String"/>
		<field name="ORDERBY" class="java.lang.Integer"/>
		<group name="COMMODITY">
			<groupExpression><![CDATA[$F{COMMODITY}]]></groupExpression>
		</group>
	</subDataset>
	<parameter name="group" class="java.lang.Integer"/>
	<parameter name="relative_dt_from" class="net.sf.jasperreports.types.date.DateRange">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="relative_dt_to" class="net.sf.jasperreports.types.date.DateRange">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="date_from" class="java.util.Date" isForPrompting="false">
		<defaultValueExpression><![CDATA[$P{relative_dt_from}.getStart()]]></defaultValueExpression>
	</parameter>
	<parameter name="date_to" class="java.util.Date" isForPrompting="false">
		<defaultValueExpression><![CDATA[$P{relative_dt_to}.getEnd()]]></defaultValueExpression>
	</parameter>
	<parameter name="pc" class="java.util.Collection"/>
	<parameter name="cmd" class="java.util.Collection"/>
	<parameter name="cbk" class="java.util.Collection"/>
	<parameter name="LE_Filter" class="java.lang.String">
		<parameterDescription><![CDATA[]]></parameterDescription>
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="asofdate" class="java.util.Date" isForPrompting="false">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="QSTR_Filter" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[" AND CONTRACT_BOOK IN ('" + $P{LE_Filter} + "')"]]></defaultValueExpression>
	</parameter>
	<parameter name="origindate" class="java.util.Date" isForPrompting="false">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT -999999 AS row_count
where 0 =(SELECT
		 COUNT(*)
		 FROM
		 (SELECT  distinct eod.CONTRACT_BOOK CONTRACT_BOOK,
								PROFIT_CENTER,
								COMMODITY,
								eod.EOD_DATE  asofdate,
								(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
									FROM DM_POSITION_DATA DPD
									WHERE DPD.CONTRACT_BOOK = eod.CONTRACT_BOOK
									AND DPD.REPORT_DATE <= eod.EOD_DATE
									AND DPD.PROFIT_CENTER = eod.PROFIT_CENTER
									--AND DPD.MATERIAL_GROUP = eod.COMMODITY
									) origindate
						FROM (
								SELECT DISTINCT DPA.CONTRACT_BOOK
												,DPA.PROFIT_CENTER
												,DPA.COMMODITY
			  									,DPA.EOD_DATE
									FROM DAILY_PNL_ATTRIBUTION DPA
									JOIN (SELECT distinct EOD_DATE
											FROM   DAILY_PNL_ATTRIBUTION B
											WHERE $X{IN,CONTRACT_BOOK,cbk}
											AND B.EOD_DATE >= $P{date_from}
											AND B.EOD_DATE <= $P{date_to}
											AND $X{IN,PROFIT_CENTER,pc}
											AND $X{IN,COMMODITY,cmd}
											) BVBV
									ON DPA.EOD_DATE = BVBV.EOD_DATE
									AND  $X{IN, DPA.CONTRACT_BOOK, cbk}
									AND $X{IN,PROFIT_CENTER,pc}
									AND $X{IN,COMMODITY,cmd}

							) eod
						WHERE 0=0
						$P!{QSTR_Filter}
						AND $X{IN,PROFIT_CENTER,pc}
						AND $X{IN,COMMODITY,cmd}
		) tbl
)
UNION
SELECT 1 AS ROWNUM
where 0 <>(SELECT
		 COUNT(*)
		 FROM
		 (SELECT  distinct eod.CONTRACT_BOOK CONTRACT_BOOK,
								PROFIT_CENTER,
								COMMODITY,
								eod.EOD_DATE  asofdate,
								(SELECT ISNULL(MAX(DPD.REPORT_DATE),NULL)
									FROM DM_POSITION_DATA DPD
									WHERE DPD.CONTRACT_BOOK = eod.CONTRACT_BOOK
									AND DPD.REPORT_DATE <= eod.EOD_DATE
									AND DPD.PROFIT_CENTER = eod.PROFIT_CENTER
									--AND DPD.MATERIAL_GROUP = eod.COMMODITY
									) origindate
						FROM (
								SELECT DISTINCT DPA.CONTRACT_BOOK
												,DPA.PROFIT_CENTER
												,DPA.COMMODITY
			  									,DPA.EOD_DATE
									FROM DAILY_PNL_ATTRIBUTION DPA
									JOIN (SELECT distinct EOD_DATE
											FROM   DAILY_PNL_ATTRIBUTION B
											WHERE $X{IN,CONTRACT_BOOK,cbk}
											AND B.EOD_DATE >= $P{date_from}
											AND B.EOD_DATE <= $P{date_to}
											AND $X{IN,PROFIT_CENTER,pc}
											AND $X{IN,COMMODITY,cmd}
											) BVBV
									ON DPA.EOD_DATE = BVBV.EOD_DATE
									AND  $X{IN, DPA.CONTRACT_BOOK, cbk}
									AND $X{IN,PROFIT_CENTER,pc}
									AND $X{IN,COMMODITY,cmd}

							) eod
						WHERE 0=0
						$P!{QSTR_Filter}
						AND $X{IN,PROFIT_CENTER,pc}
						AND $X{IN,COMMODITY,cmd}
		) tbl
)]]>
	</queryString>
	<field name="row_count" class="java.lang.Integer"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="90" splitType="Stretch">
			<image scaleImage="FillFrame" onErrorType="Blank">
				<reportElement uuid="de0a542c-05eb-4dac-865d-5ef4124be179" mode="Opaque" x="10" y="0" width="30" height="30" forecolor="#000000" backcolor="#1F497D">
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
				</box>
				<imageExpression><![CDATA["repo:reponew_logo2.png"]]></imageExpression>
			</image>
			<staticText>
				<reportElement uuid="3e7f99e4-e0c4-47ad-8e2d-e5b2b607e8c0" mode="Opaque" x="50" y="0" width="1330" height="30" forecolor="#FFFFFF" backcolor="#1F497D">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.0" lineColor="#4F81BD"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[ Olam Risk System]]></text>
			</staticText>
			<textField>
				<reportElement uuid="456c38a6-9286-4abd-84c1-f2ab470f67c5" mode="Opaque" x="0" y="30" width="1618" height="30" forecolor="#FFFFFF" backcolor="#1F497D">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{row_count}.equals( -999999 )? "No Data Available" :CONCATENATE($P{cbk}==null || $P{cbk}.size()>1 || $P{cbk}.size()== 0 ? "ALL BUs" : $P{cbk}.toString().substring(1,$P{cbk}.toString().length()-1 )," - Price Exposure History")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="1a58afae-a8d4-4436-9972-fcc62d67212e" mode="Opaque" x="1380" y="0" width="238" height="30" forecolor="#FFFFFF" backcolor="#1F497D">
					<property name="local_mesure_unity" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box leftPadding="0" rightPadding="0">
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.0" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Run Date : "+DATEFORMAT(TODAY( ),"dd-MMM-yy h:mm:ss a")]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="0bcb1490-9202-4bfb-9280-0738e1e56261" mode="Opaque" x="0" y="0" width="10" height="30" backcolor="#1F497D"/>
				<textElement/>
				<text><![CDATA[]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="095c8266-f240-43a6-a792-129187748390" mode="Opaque" x="40" y="0" width="10" height="30" backcolor="#1F497D"/>
				<textElement/>
				<text><![CDATA[]]></text>
			</staticText>
			<textField>
				<reportElement uuid="1a41d6de-051d-423b-868b-a2900dc96bbb" mode="Opaque" x="0" y="60" width="1618" height="30" forecolor="#FFFFFF" backcolor="#1F497D">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box leftPadding="2" rightPadding="2">
					<topPen lineWidth="0.5" lineColor="#4F81BD"/>
					<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
					<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
					<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[CONCATENATE("From ",new java.text.SimpleDateFormat("dd-MMM-yy").format($P{date_from})," To ",new java.text.SimpleDateFormat("dd-MMM-yy").format($P{date_to}))]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<detail>
		<band height="200" splitType="Stretch">
			<printWhenExpression><![CDATA[$P{group}==1]]></printWhenExpression>
			<crosstab>
				<reportElement uuid="4d95ec17-a32b-49d6-86ec-f8061b44b8e4" x="0" y="0" width="1620" height="200">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
				</reportElement>
				<crosstabParameter name="drilldown_path">
					<parameterValueExpression><![CDATA["/OLAM/Trading___Operation/Market_Risk_Position_1_3"]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabParameter name="cbk">
					<parameterValueExpression><![CDATA[$P{cbk}]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabParameter name="pc" class="java.util.Collection">
					<parameterValueExpression><![CDATA[$P{pc}]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabParameter name="cmd" class="java.util.Collection">
					<parameterValueExpression><![CDATA[$P{cmd}]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabDataset>
					<dataset>
						<datasetRun subDataset="profitcenter" uuid="1ae72187-3fe6-43c3-828e-23d825e7c484">
							<datasetParameter name="date_from">
								<datasetParameterExpression><![CDATA[$P{date_from}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="date_to">
								<datasetParameterExpression><![CDATA[$P{date_to}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="cmd">
								<datasetParameterExpression><![CDATA[$P{cmd}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="pc">
								<datasetParameterExpression><![CDATA[$P{pc}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="cbk">
								<datasetParameterExpression><![CDATA[$P{cbk}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="LE_Filter">
								<datasetParameterExpression><![CDATA[$P{LE_Filter}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="asofdate">
								<datasetParameterExpression><![CDATA[$P{asofdate}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="origindate">
								<datasetParameterExpression><![CDATA[$P{origindate}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
					</dataset>
				</crosstabDataset>
				<crosstabHeaderCell>
					<cellContents>
						<property name="local_mesure_unitwidth" value="pixel"/>
						<property name="local_mesure_unitheight" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
						<box>
							<topPen lineWidth="0.5" lineColor="#4F81BD"/>
							<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
							<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
							<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
						</box>
						<staticText>
							<reportElement uuid="6e02a5ef-7c9d-43f1-988f-3a801d39cbe8" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#8DB4E2">
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.0"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.0"/>
							</box>
							<textElement textAlignment="Center" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true"/>
							</textElement>
							<text><![CDATA[Position in Tons]]></text>
						</staticText>
					</cellContents>
				</crosstabHeaderCell>
				<rowGroup name="PROFIT_CENTER1" width="0">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{PROFIT_CENTER}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents backcolor="#FFFFFF" mode="Opaque" style="Crosstab 8_CH">
							<property name="local_mesure_unitwidth" value="pixel"/>
							<property name="local_mesure_unitheight" value="pixel"/>
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents backcolor="#FFCC00" mode="Opaque" style="Crosstab 8_CT"/>
					</crosstabTotalRowHeader>
				</rowGroup>
				<rowGroup name="ORDERBY1" width="0" totalPosition="Start">
					<bucket class="java.lang.Integer">
						<bucketExpression><![CDATA[$F{ORDERBY}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CH">
							<property name="local_mesure_unitwidth" value="pixel"/>
							<property name="com.jaspersoft.studio.unit.width" value="px"/>
							<box>
								<topPen lineWidth="0.0" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.0" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.0" lineColor="#4F81BD"/>
							</box>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CG">
							<property name="local_mesure_unitheight" value="pixel"/>
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField isStretchWithOverflow="true" isBlankWhenNull="true">
								<reportElement uuid="11138cf5-fa95-44de-aa32-c2860c623dd1" positionType="Float" mode="Opaque" x="0" y="0" width="180" height="30" forecolor="#FFFFFF" backcolor="#1F497D"/>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.5" lineColor="#4F81BD"/>
									<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
									<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
									<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
								</box>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="12" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{PC}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<rowGroup name="CATEGORY1" width="180">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{CATEGORY}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CH">
							<property name="local_mesure_unitwidth" value="pixel"/>
							<property name="com.jaspersoft.studio.unit.width" value="px"/>
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField>
								<reportElement uuid="14f52361-3bd6-4b14-929d-0700d6700373" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#FFFFFF">
									<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
									<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals")||!$V{CATEGORY1}.equals("   Net Fixed Price Position")||!$V{CATEGORY1}.equals("   Net Unpriced Position")||!$V{CATEGORY1}.equals("Outright")]]></printWhenExpression>
								</reportElement>
								<box leftPadding="2" rightPadding="2"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{CATEGORY1}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
							<textField isBlankWhenNull="true">
								<reportElement uuid="58d64d36-441f-4446-9c3a-a92de916d6aa" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#C7DAF1">
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.x" value="px"/>
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Futures")||$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Net Diff Position")]]></printWhenExpression>
								</reportElement>
								<box leftPadding="2" rightPadding="2"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{CATEGORY1}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
							<textField isBlankWhenNull="true">
								<reportElement uuid="7eadfff1-a368-4599-9a07-61c7d2895f2e" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#8DB4E2">
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.x" value="px"/>
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
								</reportElement>
								<box leftPadding="2" rightPadding="2"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{CATEGORY1}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CG">
							<property name="local_mesure_unitheight" value="pixel"/>
							<property name="com.jaspersoft.studio.unit.height" value="px"/>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="ATTRIBUTION_DATE1" height="30" totalPosition="Start">
					<bucket order="Descending" class="java.sql.Date">
						<bucketExpression><![CDATA[$F{ATTRIBUTION_DATE}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CH">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="dd-MMM-yy">
								<reportElement uuid="f2e40b18-3dd0-4fde-b2c9-8b93c3fbcee5" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
									<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								</reportElement>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.0"/>
									<leftPen lineWidth="0.0"/>
									<bottomPen lineWidth="0.0"/>
									<rightPen lineWidth="0.0"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CT">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement uuid="83043cf2-dea8-4d2f-b122-0b9de404988d" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.x" value="px"/>
									<property name="local_mesure_unitheight" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.height" value="px"/>
									<property name="local_mesure_unitwidth" value="pixel"/>
								</reportElement>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.0"/>
									<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
									<bottomPen lineWidth="0.0"/>
									<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<text><![CDATA[Average]]></text>
							</staticText>
							<staticText>
								<reportElement uuid="2f1e2e99-525e-49c4-8b7e-dc1c33fd0faf" mode="Opaque" x="70" y="0" width="70" height="30" backcolor="#8DB4E2">
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="local_mesure_unitheight" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.height" value="px"/>
									<property name="local_mesure_unitwidth" value="pixel"/>
								</reportElement>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.0"/>
									<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
									<bottomPen lineWidth="0.0"/>
									<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<text><![CDATA[Peak]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="QTY_MEASURE1" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{QTY}]]></measureExpression>
				</measure>
				<measure name="CopyOFMeasure_1" class="java.math.BigDecimal" calculation="Average">
					<measureExpression><![CDATA[$F{QTY}.abs()]]></measureExpression>
				</measure>
				<measure name="CopyOFMeasure_2" class="java.math.BigDecimal" calculation="Highest">
					<measureExpression><![CDATA[$F{QTY}.abs()]]></measureExpression>
				</measure>
				<measure name="PC" class="java.lang.String">
					<measureExpression><![CDATA[$F{PROFIT_CENTER}]]></measureExpression>
				</measure>
				<measure name="Category" class="java.lang.String">
					<measureExpression><![CDATA[$F{CATEGORY}]]></measureExpression>
				</measure>
				<crosstabCell width="70" height="30">
					<cellContents mode="Opaque" style="Crosstab 8_CD">
						<property name="local_mesure_unitwidth" value="pixel"/>
						<box>
							<topPen lineColor="#4F81BD"/>
							<leftPen lineColor="#4F81BD"/>
							<bottomPen lineColor="#4F81BD"/>
							<rightPen lineColor="#4F81BD"/>
						</box>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true" hyperlinkType="ReportExecution" hyperlinkTarget="Blank">
							<reportElement uuid="1f4080e7-b5a1-45fd-af76-b79bc7a22a50" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#C7DAF1">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Diff Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Structure Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{QTY_MEASURE1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$V{PROFIT_CENTER1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true" hyperlinkType="ReportExecution" hyperlinkTarget="Blank">
							<reportElement uuid="1b1ed3d9-8e57-449e-9398-7f65e084893e" x="0" y="0" width="70" height="30">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals") && !$V{CATEGORY1}.equals("   Net Fixed Price Position") &&!$V{CATEGORY1}.equals("   Net Diff Position")&& !$V{CATEGORY1}.equals("   Net Unpriced Position")&& !$V{CATEGORY1}.equals("   Net Derivatives Position") && !$V{CATEGORY1}.equals("   Outright Position") && !$V{CATEGORY1}.equals("   Basis Position")&& !$V{CATEGORY1}.equals("   Structure Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="false" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{QTY_MEASURE1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$V{PROFIT_CENTER1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true" hyperlinkType="ReportExecution" hyperlinkTarget="Blank">
							<reportElement uuid="b80f53d7-d7ea-4c49-abfa-8321d099faa3" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{QTY_MEASURE1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$V{PROFIT_CENTER1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="140" height="30" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents mode="Opaque" style="Crosstab 8_CT">
						<property name="local_mesure_unitwidth" value="pixel"/>
						<property name="local_mesure_unitheight" value="pixel"/>
						<box>
							<topPen lineColor="#4F81BD"/>
							<leftPen lineColor="#4F81BD"/>
							<bottomPen lineColor="#4F81BD"/>
							<rightPen lineColor="#4F81BD"/>
						</box>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="3508c760-d2ad-4b22-ab0d-e5b946c0493b" mode="Opaque" x="0" y="0" width="70" height="30">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals") && !$V{CATEGORY1}.equals("   Net Fixed Price Position") && !$V{CATEGORY1}.equals("   Net Unpriced Position") && !$V{CATEGORY1}.equals("   Net Futures") && !$V{CATEGORY1}.equals("Outright")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="0d534826-6e03-483b-82be-b6d11233ebb2" mode="Opaque" x="70" y="0" width="70" height="30">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals") && !$V{CATEGORY1}.equals("   Net Fixed Price Position") && !$V{CATEGORY1}.equals("   Net Unpriced Position") && !$V{CATEGORY1}.equals("   Net Futures") && !$V{CATEGORY1}.equals("Outright")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_2}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="52ac9d72-fc35-4767-b965-066b12b7524a" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#C7DAF1">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Futures")||$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Net Diff Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="db3f3706-b8f3-4fb9-a8e5-1b9e42d6ea33" mode="Opaque" x="70" y="0" width="70" height="30" backcolor="#C7DAF1">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Futures")||$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Net Diff Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_2}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="b43aa28e-9bea-4cb1-9385-4ee637e93f59" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="6715713a-4383-4fbd-9474-66a4373f30c7" mode="Opaque" x="70" y="0" width="70" height="30" backcolor="#8DB4E2">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_2}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="70" height="20" rowTotalGroup="PROFIT_CENTER1">
					<cellContents backcolor="#FFCC00" mode="Opaque" style="Crosstab 8_CT"/>
				</crosstabCell>
				<crosstabCell width="140" height="20" rowTotalGroup="PROFIT_CENTER1" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents mode="Opaque" style="Crosstab 8_CT">
						<staticText>
							<reportElement uuid="87142646-5045-40c5-89b5-77cca541207f" mode="Opaque" x="0" y="0" width="70" height="20" backcolor="#FFCC00">
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.5"/>
								<leftPen lineWidth="0.5"/>
								<bottomPen lineWidth="0.5"/>
								<rightPen lineWidth="0.5"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle"/>
							<text><![CDATA[]]></text>
						</staticText>
						<staticText>
							<reportElement uuid="4b7393d3-1b4e-4af5-a35d-974d42cd9385" mode="Opaque" x="70" y="0" width="70" height="20" backcolor="#FFCC00">
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.5"/>
								<leftPen lineWidth="0.5"/>
								<bottomPen lineWidth="0.5"/>
								<rightPen lineWidth="0.5"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle"/>
							<text><![CDATA[]]></text>
						</staticText>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="70" height="30" rowTotalGroup="ORDERBY1">
					<cellContents backcolor="#1F497D" mode="Opaque" style="Crosstab 8_CG">
						<box>
							<topPen lineWidth="0.0"/>
							<leftPen lineWidth="0.0"/>
							<bottomPen lineWidth="0.0"/>
							<rightPen lineWidth="0.5" lineColor="#1F497D"/>
						</box>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="140" height="30" rowTotalGroup="ORDERBY1" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents backcolor="#1F497D" mode="Opaque" style="Crosstab 8_CT">
						<box>
							<topPen lineWidth="0.0"/>
							<leftPen lineWidth="0.0"/>
							<bottomPen lineWidth="0.0"/>
							<rightPen lineWidth="0.0"/>
						</box>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="70" height="20" rowTotalGroup="CATEGORY1">
					<cellContents mode="Opaque" style="Crosstab 8_CG"/>
				</crosstabCell>
				<crosstabCell width="140" height="20" rowTotalGroup="CATEGORY1" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents mode="Opaque" style="Crosstab 8_CT"/>
				</crosstabCell>
			</crosstab>
		</band>
		<band height="200">
			<property name="local_mesure_unitheight" value="pixel"/>
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<printWhenExpression><![CDATA[$P{group}==2]]></printWhenExpression>
			<crosstab>
				<reportElement uuid="47dd1e85-1466-4a37-9df9-0d9f35f9dd2d" x="0" y="0" width="1620" height="200">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
				</reportElement>
				<crosstabParameter name="drilldown_path">
					<parameterValueExpression><![CDATA["/OLAM/Trading___Operation/Market_Risk_Position_1_3"]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabParameter name="cbk">
					<parameterValueExpression><![CDATA[]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabParameter name="pc" class="java.util.Collection">
					<parameterValueExpression><![CDATA[$P{pc}]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabParameter name="cmd" class="java.util.Collection">
					<parameterValueExpression><![CDATA[$P{cmd}]]></parameterValueExpression>
				</crosstabParameter>
				<crosstabDataset>
					<dataset>
						<datasetRun subDataset="product" uuid="e48a199e-8071-46e0-b422-0620c275cfa1">
							<datasetParameter name="date_from">
								<datasetParameterExpression><![CDATA[$P{date_from}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="date_to">
								<datasetParameterExpression><![CDATA[$P{date_to}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="cmd">
								<datasetParameterExpression><![CDATA[$P{cmd}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="pc">
								<datasetParameterExpression><![CDATA[$P{pc}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="cbk">
								<datasetParameterExpression><![CDATA[$P{cbk}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="LE_Filter">
								<datasetParameterExpression><![CDATA[$P{LE_Filter}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="asofdate">
								<datasetParameterExpression><![CDATA[$P{asofdate}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="origindate">
								<datasetParameterExpression><![CDATA[$P{origindate}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
					</dataset>
				</crosstabDataset>
				<crosstabHeaderCell>
					<cellContents>
						<property name="local_mesure_unitwidth" value="pixel"/>
						<property name="local_mesure_unitheight" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
						<box>
							<topPen lineWidth="0.5" lineColor="#4F81BD"/>
							<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
							<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
							<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
						</box>
						<staticText>
							<reportElement uuid="95e86f84-f59c-4053-bcf1-ba23cbb69941" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#8DB4E2">
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.0"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.0"/>
							</box>
							<textElement textAlignment="Center" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true"/>
							</textElement>
							<text><![CDATA[Position in Tons]]></text>
						</staticText>
					</cellContents>
				</crosstabHeaderCell>
				<rowGroup name="PROFIT_CENTER1" width="0">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{COMMODITY}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents backcolor="#FFFFFF" mode="Opaque" style="Crosstab 8_CH">
							<property name="local_mesure_unitwidth" value="pixel"/>
							<property name="local_mesure_unitheight" value="pixel"/>
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents backcolor="#FFCC00" mode="Opaque" style="Crosstab 8_CT">
							<staticText>
								<reportElement uuid="cd13400d-ebb5-4294-97f5-1616e1a12a18" x="0" y="0" width="250" height="20">
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.x" value="px"/>
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<property name="local_mesure_unitheight" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.height" value="px"/>
								</reportElement>
								<textElement verticalAlignment="Middle">
									<font isBold="true"/>
								</textElement>
								<text><![CDATA[Outright Position]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<rowGroup name="ORDERBY1" width="0" totalPosition="Start">
					<bucket class="java.lang.Integer">
						<bucketExpression><![CDATA[$F{ORDERBY}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CH">
							<box>
								<topPen lineWidth="0.0" lineColor="#4F81BD"/>
								<leftPen lineWidth="0.0" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0" lineColor="#4F81BD"/>
								<rightPen lineWidth="0.0" lineColor="#4F81BD"/>
							</box>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CG">
							<property name="local_mesure_unitheight" value="pixel"/>
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField isStretchWithOverflow="true">
								<reportElement uuid="2c12f10b-5dce-458c-b241-9f4bd5285177" mode="Opaque" x="0" y="0" width="180" height="30" forecolor="#FFFFFF" backcolor="#1F497D">
									<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								</reportElement>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.5" lineColor="#4F81BD"/>
									<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
									<bottomPen lineWidth="0.5" lineColor="#4F81BD"/>
									<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
								</box>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="12" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{COMM}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<rowGroup name="CATEGORY1" width="180">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{CATEGORY}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CH">
							<property name="local_mesure_unitwidth" value="pixel"/>
							<property name="com.jaspersoft.studio.unit.width" value="px"/>
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField>
								<reportElement uuid="3736db75-545b-4dfe-b652-89547f9953ef" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#FFFFFF">
									<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
									<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals")||!$V{CATEGORY1}.equals("   Net Fixed Price Position")||!$V{CATEGORY1}.equals("   Net Unpriced Position")||!$V{CATEGORY1}.equals("Outright")]]></printWhenExpression>
								</reportElement>
								<box leftPadding="2" rightPadding="2"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{CATEGORY1}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
							<textField>
								<reportElement uuid="0b8a0280-6650-4e96-b9e8-ec8dee38fe9a" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#C7DAF1">
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.x" value="px"/>
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Diff Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Structure Position")]]></printWhenExpression>
								</reportElement>
								<box leftPadding="2" rightPadding="2"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{CATEGORY1}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
							<textField>
								<reportElement uuid="eda17ffc-7645-4b51-b726-b1a4d224a468" mode="Opaque" x="0" y="0" width="180" height="30" backcolor="#8DB4E2">
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.x" value="px"/>
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
								</reportElement>
								<box leftPadding="2" rightPadding="2"/>
								<textElement verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{CATEGORY1}]]></textFieldExpression>
								<hyperlinkParameter name="_report">
									<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
								</hyperlinkParameter>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CG">
							<property name="local_mesure_unitheight" value="pixel"/>
							<property name="com.jaspersoft.studio.unit.height" value="px"/>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="ATTRIBUTION_DATE1" height="30" totalPosition="Start">
					<bucket order="Descending" class="java.sql.Date">
						<bucketExpression><![CDATA[$F{ATTRIBUTION_DATE}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CH">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<textField pattern="dd-MMM-yy">
								<reportElement uuid="70586fbf-7091-437a-8949-895b7e6b854d" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
									<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								</reportElement>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.0"/>
									<leftPen lineWidth="0.0"/>
									<bottomPen lineWidth="0.0"/>
									<rightPen lineWidth="0.0"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents mode="Opaque" style="Crosstab 8_CT">
							<box>
								<topPen lineColor="#4F81BD"/>
								<leftPen lineColor="#4F81BD"/>
								<bottomPen lineColor="#4F81BD"/>
								<rightPen lineColor="#4F81BD"/>
							</box>
							<staticText>
								<reportElement uuid="7922d8b8-31c7-4bb1-8b0a-4f5524e8d446" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.x" value="px"/>
									<property name="local_mesure_unitheight" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.height" value="px"/>
									<property name="local_mesure_unitwidth" value="pixel"/>
								</reportElement>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.0"/>
									<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
									<bottomPen lineWidth="0.0"/>
									<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<text><![CDATA[Average]]></text>
							</staticText>
							<staticText>
								<reportElement uuid="d34c7bd3-7bd8-47d7-bdc1-70d436794e46" mode="Opaque" x="70" y="0" width="70" height="30" backcolor="#8DB4E2">
									<property name="local_mesure_unity" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.y" value="px"/>
									<property name="local_mesure_unitx" value="pixel"/>
									<property name="local_mesure_unitheight" value="pixel"/>
									<property name="com.jaspersoft.studio.unit.height" value="px"/>
									<property name="local_mesure_unitwidth" value="pixel"/>
								</reportElement>
								<box leftPadding="2" rightPadding="2">
									<topPen lineWidth="0.0"/>
									<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
									<bottomPen lineWidth="0.0"/>
									<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
								</box>
								<textElement textAlignment="Center" verticalAlignment="Middle">
									<font fontName="Arial" size="11" isBold="true"/>
								</textElement>
								<text><![CDATA[Peak]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="QTY_MEASURE1" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{QTY}]]></measureExpression>
				</measure>
				<measure name="CopyOFMeasure_1" class="java.math.BigDecimal" calculation="Average">
					<measureExpression><![CDATA[$F{QTY}.abs()]]></measureExpression>
				</measure>
				<measure name="CopyOFMeasure_2" class="java.math.BigDecimal" calculation="Highest">
					<measureExpression><![CDATA[$F{QTY}.abs()]]></measureExpression>
				</measure>
				<measure name="COMM" class="java.lang.String">
					<measureExpression><![CDATA[$F{COMMODITY}]]></measureExpression>
				</measure>
				<measure name="Category" class="java.lang.String">
					<measureExpression><![CDATA[$F{CATEGORY}]]></measureExpression>
				</measure>
				<crosstabCell width="70" height="30">
					<cellContents mode="Opaque" style="Crosstab 8_CD">
						<property name="local_mesure_unitwidth" value="pixel"/>
						<box>
							<topPen lineColor="#4F81BD"/>
							<leftPen lineColor="#4F81BD"/>
							<bottomPen lineColor="#4F81BD"/>
							<rightPen lineColor="#4F81BD"/>
						</box>
						<textField pattern="#,##0;(#,##0)" hyperlinkType="ReportExecution" hyperlinkTarget="Blank">
							<reportElement uuid="dbe461e2-f883-40b2-8755-b1c99ec3a8d2" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#C7DAF1">
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Diff Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Structure Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{QTY_MEASURE1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$V{PROFIT_CENTER1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" hyperlinkType="ReportExecution" hyperlinkTarget="Blank">
							<reportElement uuid="3a6f0ad5-e617-459d-acc0-6b5a205d653c" x="0" y="0" width="70" height="30">
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals") && !$V{CATEGORY1}.equals("   Net Fixed Price Position") &&!$V{CATEGORY1}.equals("   Net Diff Position")&& !$V{CATEGORY1}.equals("   Net Unpriced Position")&& !$V{CATEGORY1}.equals("   Net Derivatives Position") && !$V{CATEGORY1}.equals("   Outright Position") && !$V{CATEGORY1}.equals("   Basis Position")&& !$V{CATEGORY1}.equals("   Structure Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="false" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{QTY_MEASURE1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$V{PROFIT_CENTER1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" hyperlinkType="ReportExecution" hyperlinkTarget="Blank">
							<reportElement uuid="a79d1894-ce79-4388-a91a-e41ec0eb7578" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2"/>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{QTY_MEASURE1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$V{PROFIT_CENTER1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="140" height="30" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents mode="Opaque" style="Crosstab 8_CT">
						<box>
							<topPen lineColor="#4F81BD"/>
							<leftPen lineColor="#4F81BD"/>
							<bottomPen lineColor="#4F81BD"/>
							<rightPen lineColor="#4F81BD"/>
						</box>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="924c2b6c-e135-45b5-b9d8-ecaa41a0975d" mode="Opaque" x="0" y="0" width="70" height="30">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals") && !$V{CATEGORY1}.equals("   Net Fixed Price Position") && !$V{CATEGORY1}.equals("   Net Unpriced Position") && !$V{CATEGORY1}.equals("   Net Futures") && !$V{CATEGORY1}.equals("Outright")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="0bd6d553-87e7-4be1-86a5-8ecb8df60993" mode="Opaque" x="70" y="0" width="70" height="30">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<printWhenExpression><![CDATA[!$V{CATEGORY1}.equals("   Net Physicals") && !$V{CATEGORY1}.equals("   Net Fixed Price Position") && !$V{CATEGORY1}.equals("   Net Unpriced Position") && !$V{CATEGORY1}.equals("   Net Futures") && !$V{CATEGORY1}.equals("Outright")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_2}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="aa569ffa-9671-4562-9cc2-63aa43e17579" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#C7DAF1">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Diff Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Structure Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="c4f66572-0594-4dc8-8fa5-d25d32bec931" mode="Opaque" x="70" y="0" width="70" height="30" backcolor="#C7DAF1">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Net Physicals")||$V{CATEGORY1}.equals("   Net Fixed Price Position")||$V{CATEGORY1}.equals("   Net Diff Position")||$V{CATEGORY1}.equals("   Net Unpriced Position")||$V{CATEGORY1}.equals("   Net Derivatives Position")||$V{CATEGORY1}.equals("   Outright Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Structure Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_2}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="aea248df-e475-4dbd-a012-42e9a6d540e2" mode="Opaque" x="0" y="0" width="70" height="30" backcolor="#8DB4E2">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_1}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
						<textField pattern="#,##0;(#,##0)" isBlankWhenNull="true">
							<reportElement uuid="87242182-bab8-4429-a029-f9e54f0bbd07" mode="Opaque" x="70" y="0" width="70" height="30" backcolor="#8DB4E2">
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
								<printWhenExpression><![CDATA[$V{CATEGORY1}.equals("   Structure Position")||$V{CATEGORY1}.equals("   Basis Position")||$V{CATEGORY1}.equals("   Outright Position")]]></printWhenExpression>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.0"/>
								<leftPen lineWidth="0.5" lineColor="#4F81BD"/>
								<bottomPen lineWidth="0.0"/>
								<rightPen lineWidth="0.5" lineColor="#4F81BD"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle">
								<font fontName="Arial" size="11" isBold="true" isItalic="false"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{CopyOFMeasure_2}]]></textFieldExpression>
							<hyperlinkParameter name="_report">
								<hyperlinkParameterExpression><![CDATA[$P{drilldown_path}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cbk">
								<hyperlinkParameterExpression><![CDATA[$P{cbk}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="pc">
								<hyperlinkParameterExpression><![CDATA[$P{pc}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="cmd">
								<hyperlinkParameterExpression><![CDATA[$P{cmd}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
							<hyperlinkParameter name="asofdate">
								<hyperlinkParameterExpression><![CDATA[$V{ATTRIBUTION_DATE1}]]></hyperlinkParameterExpression>
							</hyperlinkParameter>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="70" height="20" rowTotalGroup="PROFIT_CENTER1">
					<cellContents backcolor="#FFCC00" mode="Opaque" style="Crosstab 8_CT"/>
				</crosstabCell>
				<crosstabCell width="140" height="20" rowTotalGroup="PROFIT_CENTER1" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents mode="Opaque" style="Crosstab 8_CT">
						<staticText>
							<reportElement uuid="769b9fc3-1334-45da-bb0a-380d3d2c583c" mode="Opaque" x="0" y="0" width="70" height="20" backcolor="#FFCC00">
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.5"/>
								<leftPen lineWidth="0.5"/>
								<bottomPen lineWidth="0.5"/>
								<rightPen lineWidth="0.5"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle"/>
							<text><![CDATA[]]></text>
						</staticText>
						<staticText>
							<reportElement uuid="5728d5ae-011a-436d-8420-a956f1ebbabc" mode="Opaque" x="70" y="0" width="70" height="20" backcolor="#FFCC00">
								<property name="local_mesure_unity" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.y" value="px"/>
								<property name="local_mesure_unitx" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.x" value="px"/>
								<property name="local_mesure_unitheight" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.height" value="px"/>
								<property name="local_mesure_unitwidth" value="pixel"/>
								<property name="com.jaspersoft.studio.unit.width" value="px"/>
							</reportElement>
							<box leftPadding="2" rightPadding="2">
								<topPen lineWidth="0.5"/>
								<leftPen lineWidth="0.5"/>
								<bottomPen lineWidth="0.5"/>
								<rightPen lineWidth="0.5"/>
							</box>
							<textElement textAlignment="Right" verticalAlignment="Middle"/>
							<text><![CDATA[]]></text>
						</staticText>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="70" height="30" rowTotalGroup="ORDERBY1">
					<cellContents backcolor="#1F497D" mode="Opaque" style="Crosstab 8_CG">
						<box>
							<topPen lineWidth="0.0"/>
							<leftPen lineWidth="0.0"/>
							<bottomPen lineWidth="0.0"/>
							<rightPen lineWidth="0.0" lineColor="#1F497D"/>
						</box>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="140" height="30" rowTotalGroup="ORDERBY1" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents backcolor="#1F497D" mode="Opaque" style="Crosstab 8_CT">
						<box>
							<topPen lineWidth="0.0"/>
							<leftPen lineWidth="0.0"/>
							<bottomPen lineWidth="0.0"/>
							<rightPen lineWidth="0.0"/>
						</box>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="70" height="20" rowTotalGroup="CATEGORY1">
					<cellContents mode="Opaque" style="Crosstab 8_CG"/>
				</crosstabCell>
				<crosstabCell width="140" height="20" rowTotalGroup="CATEGORY1" columnTotalGroup="ATTRIBUTION_DATE1">
					<cellContents mode="Opaque" style="Crosstab 8_CT"/>
				</crosstabCell>
			</crosstab>
		</band>
	</detail>
	<pageFooter>
		<band height="54" splitType="Stretch">
			<textField>
				<reportElement uuid="9803e2a4-71a6-4097-9262-07afb9c781bf" positionType="Float" x="1360" y="0" width="120" height="20">
					<property name="local_mesure_unitx" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
				</reportElement>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="5cc1f2cf-946d-41fc-8666-13c286970928" x="1482" y="0" width="100" height="20">
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
				</reportElement>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
